

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="Python 3.7" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="Python 3.7" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>COMET.utilities &mdash; COMET beta documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="../../_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="../../" src="../../_static/documentation_options.js"></script>
        <script type="text/javascript" src="../../_static/jquery.js"></script>
        <script type="text/javascript" src="../../_static/underscore.js"></script>
        <script type="text/javascript" src="../../_static/doctools.js"></script>
    
    <script type="text/javascript" src="../../_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="../../_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="../../_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="../../genindex.html" />
    <link rel="search" title="Search" href="../../search.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="../../index.html" class="icon icon-home"> COMET
          

          
          </a>

          
            
            
              <div class="version">
                0.10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">COMET Guides</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../programstructure.html">COMET layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../tutorial.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../measurementjobgen.html">Measurement Job Generation</a></li>
</ul>
<p class="caption"><span class="caption-text">COMET Structure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../datastructure.html">Data Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../dataexchange.html">Data Exchange</a></li>
</ul>
<p class="caption"><span class="caption-text">Measurement Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../measurement_plugins/IVCV.html">IVCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../measurement_plugins/Stripscan.html">Stripscan</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../measurement_plugins/RelaxTimeAnalysis.html">Relaxation Time Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">General Purpose Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../GUI_plugins/resources.html">Resources Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GUI_plugins/Device_Com.html">Device Communication Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GUI_plugins/Data_Explorer.html">Data Explorer</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GUI_plugins/Data_Visualization.html">Data Visualization and Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GUI_plugins/Documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../GUI_plugins/Switching_Control.html">Switching Matrix Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Code references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html">Measurement Tool Box functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html#vcw-visa-connect-wizard">VCW - Visa Connect Wizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html#xyz-stage-control-class">XYZ-Stage Control Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../Tools.html#switching-system-control-class">Switching System Control Class</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../index.html">COMET</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="../../index.html">Docs</a> &raquo;</li>
        
          <li><a href="../index.html">Module code</a> &raquo;</li>
        
      <li>COMET.utilities</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <h1>Source code for COMET.utilities</h1><div class="highlight"><pre>
<span></span><span class="c1">#This class provides usefull functions for gernerall purposes</span>

<span class="kn">import</span> <span class="nn">os</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">os.path</span><span class="o">,</span> <span class="nn">re</span>
<span class="c1">#sys.path.append(os.path.join( os.path.dirname(__file__), &#39;..&#39;,))</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="k">import</span> <span class="n">sleep</span><span class="p">,</span> <span class="n">time</span>
<span class="kn">import</span> <span class="nn">time</span>
<span class="kn">import</span> <span class="nn">threading</span>
<span class="kn">import</span> <span class="nn">traceback</span>
<span class="kn">import</span> <span class="nn">yaml</span>
<span class="kn">import</span> <span class="nn">logging.config</span>
<span class="kn">from</span> <span class="nn">PyQt5</span> <span class="k">import</span> <span class="n">QtCore</span><span class="p">,</span> <span class="n">QtGui</span><span class="p">,</span> <span class="n">QtWidgets</span>
<span class="kn">from</span> <span class="nn">PyQt5.QtWidgets</span> <span class="k">import</span> <span class="n">QApplication</span><span class="p">,</span> <span class="n">QDialog</span><span class="p">,</span> <span class="n">QPushButton</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>
<span class="kn">from</span> <span class="nn">numpy.linalg</span> <span class="k">import</span> <span class="n">inv</span>
<span class="kn">import</span> <span class="nn">datetime</span>
<span class="kn">import</span> <span class="nn">pyqtgraph</span> <span class="k">as</span> <span class="nn">pg</span>
<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">from</span> <span class="nn">.engineering_notation</span> <span class="k">import</span> <span class="n">EngUnit</span>
<span class="kn">import</span> <span class="nn">json</span>
<span class="kn">import</span> <span class="nn">pandas</span> <span class="k">as</span> <span class="nn">pd</span>
<span class="kn">import</span> <span class="nn">queue</span>
<span class="kn">from</span> <span class="nn">.globals</span> <span class="k">import</span> <span class="n">message_to_main</span><span class="p">,</span> <span class="n">message_from_main</span><span class="p">,</span> <span class="n">queue_to_GUI</span>
<span class="c1">#from __future__ import print_function # Needed for the rtd functions that its written in 3</span>

<span class="n">l</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;utilities&quot;</span><span class="p">)</span>
<span class="n">lock</span> <span class="o">=</span> <span class="n">threading</span><span class="o">.</span><span class="n">Lock</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">raise_exception</span><span class="p">(</span><span class="n">method</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Intended to be used as decorator for pyQt functions in the case that errors are not correctly passed to the python interpret</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">raise_ex</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Try running the method</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
        <span class="c1"># raise the exception and print the stack trace</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Some error occured in the function </span><span class="si">{}</span><span class="s2">. With Error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span><span class="n">error</span><span class="p">))</span>  <span class="c1"># this is optional but sometime the raise does not work</span>
            <span class="k">raise</span>  <span class="c1"># this raises the error with stack backtrack</span>
        <span class="k">return</span> <span class="n">result</span>

    <span class="k">return</span> <span class="n">raise_ex</span>  <span class="c1"># here the memberfunction timed will be called</span>

    <span class="c1"># This function works as a decorator to raise errors if python interpretor does not do that automatically</span>

<span class="k">class</span> <span class="nc">ErrorMessageBoxHandler</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This class shows an error message to the user which then can be quit&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span> <span class="n">title</span><span class="o">=</span><span class="s2">&quot;COMET encountered an Error&quot;</span><span class="p">,</span> <span class="n">QiD</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        If you pass a message to the init only this message will be shown. To accumulate several messages to prevent</span>
<span class="sd">        message spamming use the function new_message within the instance</span>
<span class="sd">        :param message:</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_message_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_buffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="o">=</span> <span class="mf">0.1</span> <span class="c1"># seconds</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">title</span> <span class="o">=</span> <span class="n">title</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">setSingleShot</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">show_messages</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_dialog</span> <span class="o">=</span> <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QErrorMessage</span><span class="p">(</span><span class="n">QiD</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_dialog</span><span class="o">.</span><span class="n">setModal</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_dialog</span><span class="o">.</span><span class="n">setWindowTitle</span><span class="p">(</span><span class="n">title</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_dialog</span><span class="o">.</span><span class="n">setGeometry</span><span class="p">((</span><span class="mi">1920</span><span class="o">-</span><span class="mi">450</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="p">(</span><span class="mi">1080</span><span class="o">-</span><span class="mi">250</span><span class="p">)</span><span class="o">/</span><span class="mi">2</span><span class="p">,</span> <span class="mi">450</span><span class="p">,</span> <span class="mi">250</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">start</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

        <span class="k">if</span> <span class="n">message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">message_buffer</span> <span class="o">=</span> <span class="n">message</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_messages</span><span class="p">()</span>

    <span class="k">def</span> <span class="nf">new_message</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Adds a new message&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_buffer</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">message</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span>
        <span class="n">display_message</span> <span class="o">=</span> <span class="kc">True</span> <span class="k">if</span> <span class="p">(</span><span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span><span class="o">-</span><span class="bp">self</span><span class="o">.</span><span class="n">last_message_time</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="bp">self</span><span class="o">.</span><span class="n">timeout</span> <span class="k">else</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">last_message_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
        <span class="k">if</span> <span class="n">display_message</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">show_messages</span><span class="p">()</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">timeout</span><span class="o">*</span><span class="mi">1000</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">show_messages</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Simply shows all messages&quot;&quot;&quot;</span>
        <span class="c1">#message = &quot;&quot;.join(self.message_buffer)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_dialog</span><span class="o">.</span><span class="n">showMessage</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">message_buffer</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">error_dialog</span><span class="o">.</span><span class="n">activateWindow</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_buffer</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

<span class="k">class</span> <span class="nc">QueueEmitHandler</span><span class="p">(</span><span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">queue</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="nb">eval</span><span class="p">(</span><span class="n">queue</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log_LEVELS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NOTSET&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>
        <span class="n">logging</span><span class="o">.</span><span class="n">Handler</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">emit</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">record</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">record</span><span class="o">.</span><span class="n">levelno</span> <span class="o">==</span> <span class="bp">self</span><span class="o">.</span><span class="n">level</span><span class="p">:</span>
            <span class="n">msg</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Error&quot;</span><span class="p">:</span> <span class="n">record</span><span class="o">.</span><span class="n">message</span><span class="p">}</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">msg</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">setLevel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">level</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Warning this set level works different to the logging levels from the logging modules</span>
<span class="sd">        It only loggs the specific level!!!&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">level</span> <span class="o">=</span> <span class="n">level</span>

<span class="k">def</span> <span class="nf">exception_handler</span><span class="p">(</span><span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Custom exception handler raising a dialog box.</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; import sys</span>
<span class="sd">    &gt;&gt;&gt; sys.excepthook = exception_handler</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="n">exctype</span> <span class="ow">is</span> <span class="ow">not</span> <span class="ne">KeyboardInterrupt</span><span class="p">:</span>
        <span class="n">tr</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QCoreApplication</span><span class="o">.</span><span class="n">translate</span>
        <span class="c1"># Prepare pretty stacktrace</span>
        <span class="n">message</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">linesep</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">traceback</span><span class="o">.</span><span class="n">format_tb</span><span class="p">(</span><span class="n">tb</span><span class="p">))</span>
        <span class="n">QtWidgets</span><span class="o">.</span><span class="n">QMessageBox</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="kc">None</span><span class="p">,</span>
            <span class="n">tr</span><span class="p">(</span><span class="s2">&quot;QMessageBox&quot;</span><span class="p">,</span> <span class="s2">&quot;Uncaught exception occured&quot;</span><span class="p">),</span>
            <span class="n">tr</span><span class="p">(</span><span class="s2">&quot;QMessageBox&quot;</span><span class="p">,</span>
               <span class="s2">&quot;Exception type: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
               <span class="s2">&quot;Exception value: </span><span class="si">{}</span><span class="se">\n</span><span class="s2">&quot;</span>
               <span class="s2">&quot;Traceback: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">exctype</span><span class="o">.</span><span class="vm">__name__</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">message</span><span class="p">)</span>
        <span class="p">)</span>
    <span class="c1"># Pass on exception</span>
    <span class="n">sys</span><span class="o">.</span><span class="n">__excepthook__</span><span class="p">(</span><span class="n">exctype</span><span class="p">,</span> <span class="n">value</span><span class="p">,</span> <span class="n">tb</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_available_setups</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Return list of available setups names (resembling setup directory names).</span>
<span class="sd">    A valid setup must provide at least the following file tree:</span>

<span class="sd">    &lt;setup&gt;/</span>
<span class="sd">      config/</span>
<span class="sd">        settings.yml</span>

<span class="sd">    Example:</span>
<span class="sd">    &gt;&gt;&gt; get_available_setups(&#39;./config/setups&#39;)</span>
<span class="sd">    [&#39;Bad Strip Analysis&#39;, &#39;QTC&#39;]</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">available</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">path</span> <span class="ow">in</span> <span class="n">os</span><span class="o">.</span><span class="n">listdir</span><span class="p">(</span><span class="n">location</span><span class="p">):</span>
        <span class="n">path</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">location</span><span class="p">,</span> <span class="n">path</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
            <span class="c1"># sanity check, contains a config/settings.yml file?</span>
            <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;settings.yml&#39;</span><span class="p">)):</span>
                <span class="n">available</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">basename</span><span class="p">(</span><span class="n">path</span><span class="p">))</span>
    <span class="k">return</span> <span class="n">available</span>

<span class="k">def</span> <span class="nf">write_init_file</span><span class="p">(</span> <span class="n">name</span><span class="p">,</span> <span class="n">data</span><span class="p">,</span> <span class="n">path</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function writes config files for devices and default files</span>

<span class="sd">        :param name: Name of the file to be written to</span>
<span class="sd">        :param data: Data in Dict format</span>
<span class="sd">        :param path: Path where to write</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="c1"># find the resource and exclude it from the file</span>
        <span class="n">data</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">copy</span><span class="p">()</span>

        <span class="c1">#Removes the Visa resource if needed</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="n">data</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="s2">&quot;Visa_Resource&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="k">pass</span>

        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">path</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">)):</span>

            <span class="n">os</span><span class="o">.</span><span class="n">remove</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">))</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">create_new_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">path</span><span class="p">,</span> <span class="n">os_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.yaml&quot;</span><span class="p">)</span>
            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>
            <span class="n">close_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>

        <span class="k">elif</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">path</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;.yaml&quot;</span><span class="p">)):</span>

            <span class="c1">#directory = path[:len(path) - len(path.split(&quot;/&quot;)[-1])]</span>

            <span class="n">filename</span> <span class="o">=</span> <span class="n">create_new_file</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">name</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;.&quot;</span><span class="p">)[</span><span class="mi">0</span><span class="p">]),</span> <span class="n">path</span><span class="p">,</span> <span class="n">os_file</span><span class="o">=</span><span class="kc">False</span><span class="p">,</span> <span class="n">suffix</span><span class="o">=</span><span class="s2">&quot;.yaml&quot;</span><span class="p">)</span>

            <span class="n">yaml</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">filename</span><span class="p">,</span> <span class="n">indent</span><span class="o">=</span><span class="mi">4</span><span class="p">)</span>

            <span class="n">close_file</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span>


            <span class="c1"># Debricated</span>
            <span class="c1">#for items in data.items():</span>
            <span class="c1">#    if type(items[1]) != type([]):</span>
            <span class="c1">#        string = str(items[0]) + &quot; = \&quot;&quot; + str(items[1]) + &quot;\&quot;\n&quot;</span>
            <span class="c1">#        os.write(filename, str(string))</span>
            <span class="c1">#    else:</span>
            <span class="c1">#        string = str(items[0]) + &quot; = \&quot;&quot;</span>
            <span class="c1">#        for i in items[1]:</span>
            <span class="c1">#            string += str(i).strip(&quot;&#39;&quot;).strip(&quot;[&quot;).strip(&quot;]&quot;) + &quot;,&quot;</span>
            <span class="c1">#        string = string[:-1]</span>
            <span class="c1">#        string += &quot;\&quot;\n&quot;</span>
            <span class="c1">#        print string</span>
            <span class="c1">#        os.write(filename, string)</span>



        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span>

    <span class="c1"># This function works as a decorator to measure the time of function to execute</span>

<span class="k">def</span> <span class="nf">timeit</span><span class="p">(</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Intended to be used as decorator for functions. It returns the time needed for the function to run</span>

<span class="sd">        :param method: method to be timed</span>
<span class="sd">        :return: time needed by method</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">def</span> <span class="nf">timed</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
            <span class="n">start_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>
            <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
            <span class="n">end_time</span> <span class="o">=</span> <span class="n">time</span><span class="o">.</span><span class="n">time</span><span class="p">()</span>

            <span class="n">exce_time</span> <span class="o">=</span> <span class="n">end_time</span><span class="o">-</span><span class="n">start_time</span>

            <span class="k">return</span> <span class="n">result</span><span class="p">,</span> <span class="n">exce_time</span>

        <span class="k">return</span> <span class="n">timed</span> <span class="c1"># here the memberfunction timed will be called</span>

    <span class="c1"># These functions are for reading and writing to files------------------------------------</span>
    <span class="c1">#-----------------------------------------------------------------------------------------</span>

    <span class="c1"># This function works as a decorator to raise errors if python interpretor does not do that automatically</span>



<span class="k">def</span> <span class="nf">run_with_lock</span><span class="p">(</span> <span class="n">method</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Intended to be used as decorator for functions which need to be threadsave. Warning: all functions acquire the same lock, be carefull.</span>


<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">def</span> <span class="nf">with_lock</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="c1"># Try running the method</span>
                <span class="k">with</span> <span class="n">lock</span><span class="p">:</span>
                    <span class="n">l</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Lock acquired by program: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
                    <span class="n">result</span> <span class="o">=</span> <span class="n">method</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">,</span> <span class="o">**</span><span class="n">kw</span><span class="p">)</span>
                <span class="n">l</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Lock released by program: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">))</span>
            <span class="c1"># raise the exception and print the stack trace</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">error</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;A lock could not be acquired in &quot;</span>  <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">method</span><span class="o">.</span><span class="vm">__name__</span><span class="p">)</span> <span class="o">+</span><span class="s2">&quot;. With Error:&quot;</span><span class="p">,</span> <span class="nb">repr</span><span class="p">(</span><span class="n">error</span><span class="p">))</span> <span class="c1"># this is optional but sometime the raise does not work</span>
                <span class="k">raise</span>  <span class="c1"># this raises the error with stack backtrace</span>
            <span class="k">return</span> <span class="n">result</span>

        <span class="k">return</span> <span class="n">with_lock</span>  <span class="c1"># here the memberfunction timed will be called</span>

    <span class="c1"># Creates a new file</span>

<span class="k">def</span> <span class="nf">create_new_file</span><span class="p">(</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;default.txt&quot;</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;default_path&quot;</span><span class="p">,</span> <span class="n">os_file</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">suffix</span> <span class="o">=</span> <span class="s2">&quot;.txt&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simply creates a file</span>

<span class="sd">        :param filename:</span>
<span class="sd">        :param filepath:</span>
<span class="sd">        :param os_file:</span>
<span class="sd">        :param suffix:</span>
<span class="sd">        :return:</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>

        <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s2">&quot;default_path&quot;</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
        <span class="k">elif</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s2">&quot;&quot;</span><span class="p">:</span>
            <span class="k">pass</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">+=</span> <span class="s2">&quot;/&quot;</span>

        <span class="n">filename</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">suffix</span><span class="p">)</span>

        <span class="c1">#First check if Filename already exists, when so, add a counter to the file.</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="o">+</span><span class="n">filename</span><span class="p">)):</span>
            <span class="n">l</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Warning filename &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; already exists!&quot;</span><span class="p">)</span>
            <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="o">+</span> <span class="s2">&quot;_&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span> <span class="c1"># Adds sufix to filename</span>
            <span class="k">while</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isfile</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="o">+</span><span class="n">filename</span><span class="p">)):</span>  <span class="c1"># checks if file exists</span>
                <span class="n">filename</span> <span class="o">=</span> <span class="n">filename</span><span class="p">[:</span><span class="o">-</span><span class="mi">5</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">counter</span><span class="p">)</span>  <span class="o">+</span> <span class="s2">&quot;.txt&quot;</span>  <span class="c1"># if exists than change the last number in filename string</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">l</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Filename changed to &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span><span class="p">)</span>

        <span class="k">if</span> <span class="n">os_file</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="o">+</span><span class="n">filename</span><span class="p">),</span> <span class="n">os</span><span class="o">.</span><span class="n">O_WRONLY</span> <span class="o">|</span> <span class="n">os</span><span class="o">.</span><span class="n">O_CREAT</span><span class="p">)</span> <span class="c1"># Creates the file</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">abspath</span><span class="p">(</span><span class="n">filepath</span><span class="o">+</span><span class="n">filename</span><span class="p">),</span> <span class="s2">&quot;w&quot;</span><span class="p">)</span>

        <span class="n">l</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Generated file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">))</span>

        <span class="k">return</span> <span class="n">fp</span>

    <span class="c1"># Opens a file for reading and writing</span>

<span class="k">def</span> <span class="nf">open_file</span><span class="p">(</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;default.txt&quot;</span><span class="p">,</span> <span class="n">filepath</span><span class="o">=</span><span class="s2">&quot;default_path&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Just opens a file and returns the file pointer</span>

<span class="sd">        :return: File</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">if</span> <span class="n">filepath</span> <span class="o">==</span> <span class="s2">&quot;default_path&quot;</span><span class="p">:</span>
            <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="n">fp</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">,</span> <span class="s1">&#39;r+&#39;</span><span class="p">)</span> <span class="c1">#Opens file for reading and writing</span>
            <span class="k">return</span> <span class="n">fp</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">filepath</span> <span class="o">+</span> <span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is not an existing file.&quot;</span><span class="p">)</span>

    <span class="c1"># Closes a file (just needs the file pointer)</span>

<span class="k">def</span> <span class="nf">close_file</span><span class="p">(</span> <span class="n">fp</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Closed the file specified in param fp</span>

<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">os</span><span class="o">.</span><span class="n">close</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">close</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">GeneratorExit</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Closing the file: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; was not possible&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown error occured, while closing file &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Error: &quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

    <span class="c1"># This flushes a string to a file</span>

<span class="k">def</span> <span class="nf">flush_to_file</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="n">message</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Flushes data to a opend file</span>
<span class="sd">        Only strings or numbers allowed, Lists will work too but may cause data scrambling</span>
<span class="sd">        Only use this with created files from function &#39;create_new_file&#39;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">os</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">fp</span><span class="p">,</span> <span class="nb">str</span><span class="o">.</span><span class="n">encode</span><span class="p">(</span><span class="n">message</span><span class="p">))</span> <span class="c1">#Writes the message to file</span>
        <span class="n">os</span><span class="o">.</span><span class="n">fsync</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span> <span class="c1"># ensures that the data is written on HDD</span>

<span class="k">def</span> <span class="nf">write_to_file</span><span class="p">(</span> <span class="n">content</span><span class="p">,</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;default.txt&quot;</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;default_path&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This writes content to a file. Be aware, input must be of type &#39;list&#39; each entry containing the information of one line</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">content</span><span class="p">:</span>
                <span class="n">fp</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">line</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Writing to file &quot;</span> <span class="o">+</span> <span class="n">filename</span> <span class="o">+</span> <span class="s2">&quot; was not possible&quot;</span><span class="p">)</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown error occured, while writing to file &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Error: &quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">close_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">read_from_file</span><span class="p">(</span> <span class="n">filename</span><span class="o">=</span><span class="s2">&quot;default.txt&quot;</span><span class="p">,</span> <span class="n">filepath</span> <span class="o">=</span> <span class="s2">&quot;default_path&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Gives you the content of the file in an list, each list entry is one line of the file (datatype=string)</span>
<span class="sd">        Warning: File gets closed after reading</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">fp</span> <span class="o">=</span> <span class="n">open_file</span><span class="p">(</span><span class="n">filename</span><span class="p">,</span> <span class="n">filepath</span><span class="p">)</span>

        <span class="k">try</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">fp</span><span class="o">.</span><span class="n">readlines</span><span class="p">()</span>
        <span class="k">except</span> <span class="ne">IOError</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not read from file.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="p">[]</span>
        <span class="k">except</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Unknown error occured, while reading from file &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">filename</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot;Error: &quot;</span><span class="p">,</span> <span class="n">sys</span><span class="o">.</span><span class="n">exc_info</span><span class="p">()[</span><span class="mi">0</span><span class="p">])</span>

        <span class="n">close_file</span><span class="p">(</span><span class="n">fp</span><span class="p">)</span>

    <span class="c1"># These functions are for reading and writing to files------------------------------------</span>
    <span class="c1"># -------------------------------------------------------------------------------------end</span>

<span class="k">def</span> <span class="nf">ramp_voltage_job</span><span class="p">(</span> <span class="n">queue</span><span class="p">,</span> <span class="n">resource</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">voltage_Start</span><span class="p">,</span> <span class="n">voltage_End</span><span class="p">,</span> <span class="n">step</span><span class="p">,</span> <span class="n">wait_time</span> <span class="o">=</span> <span class="mf">0.2</span><span class="p">,</span> <span class="n">complience</span><span class="o">=</span><span class="mf">100e-6</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Only use this function for simple ramping for the main, never inside a measurement!!!</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">job</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;Measurement&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;ramp_voltage&quot;</span><span class="p">:</span> <span class="p">{</span><span class="s2">&quot;Resource&quot;</span><span class="p">:</span> <span class="n">resource</span><span class="p">,</span>
                                <span class="s2">&quot;Order&quot;</span><span class="p">:</span> <span class="n">order</span><span class="p">,</span>
                                <span class="s2">&quot;StartVolt&quot;</span><span class="p">:</span> <span class="n">voltage_Start</span><span class="p">,</span>
                                <span class="s2">&quot;EndVolt&quot;</span><span class="p">:</span> <span class="n">voltage_End</span><span class="p">,</span>
                                <span class="s2">&quot;Steps&quot;</span><span class="p">:</span> <span class="n">step</span><span class="p">,</span>
                                <span class="s2">&quot;Wait&quot;</span><span class="p">:</span> <span class="n">wait_time</span><span class="p">,</span>
                                <span class="s2">&quot;Complience&quot;</span><span class="p">:</span> <span class="n">complience</span><span class="p">}}}</span>
        <span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">job</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">int2dt</span><span class="p">(</span> <span class="n">ts</span><span class="p">,</span> <span class="n">ts_mult</span> <span class="o">=</span> <span class="mf">1e3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Convert seconds value into datatime struct which can be used for x-axis labeeling</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">datetime</span><span class="o">.</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">ts_mult</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">get_timestring_from_int</span><span class="p">(</span> <span class="n">time_array</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Converts int time to timestring</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="nb">list</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">time_array</span><span class="p">:</span>
            <span class="nb">list</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">value</span><span class="p">,</span> <span class="n">int2dt</span><span class="p">(</span><span class="n">value</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>
        <span class="k">return</span> <span class="nb">list</span>

<span class="k">def</span> <span class="nf">get_thicks_for_timestamp_plot</span><span class="p">(</span> <span class="n">time_array</span><span class="p">,</span> <span class="n">max_number_of_thicks</span> <span class="o">=</span> <span class="mi">10</span><span class="p">,</span> <span class="nb">format</span> <span class="o">=</span> <span class="s2">&quot;%H:%M:%S&quot;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This gives back a list of tuples for the thicks</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">final_thicks</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_array</span><span class="p">)</span> <span class="o">&lt;=</span> <span class="n">max_number_of_thicks</span><span class="p">:</span>
            <span class="n">final_thicks</span> <span class="o">=</span> <span class="n">get_timestring_from_int</span><span class="p">(</span><span class="n">time_array</span><span class="p">,</span> <span class="nb">format</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">length</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">time_array</span><span class="p">)</span>
            <span class="n">delta</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">length</span><span class="o">/</span><span class="n">max_number_of_thicks</span><span class="p">)</span>
            <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="n">length</span><span class="p">,</span> <span class="n">delta</span><span class="p">):</span>
                <span class="n">final_thicks</span><span class="o">.</span><span class="n">append</span><span class="p">((</span><span class="n">time_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span> <span class="n">int2dt</span><span class="p">(</span><span class="n">time_array</span><span class="p">[</span><span class="n">i</span><span class="p">],</span><span class="mi">1</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="nb">format</span><span class="p">)))</span>
        <span class="k">return</span> <span class="n">final_thicks</span>

<span class="k">class</span> <span class="nc">CAxisTime</span><span class="p">(</span><span class="n">pg</span><span class="o">.</span><span class="n">AxisItem</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Over riding the tickString method by extending the class&quot;&quot;&quot;</span>

            <span class="c1"># @param[in] values List of time.</span>
            <span class="c1"># @param[in] scale Not used.</span>
            <span class="c1"># @param[in] spacing Not used.</span>
        <span class="k">def</span> <span class="nf">tickStrings</span><span class="p">(</span> <span class="n">values</span><span class="p">,</span> <span class="n">scale</span><span class="p">,</span> <span class="n">spacing</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Generate the string labeling of X-axis from the seconds value of Y-axis&quot;&quot;&quot;</span>
            <span class="c1"># sending a list of values in format &quot;HH:MM:SS.SS&quot; generated from Total seconds.</span>
            <span class="k">return</span> <span class="p">[(</span><span class="n">int2dt</span><span class="p">(</span><span class="n">value</span><span class="p">)</span><span class="o">.</span><span class="n">strftime</span><span class="p">(</span><span class="s2">&quot;%H:%M:%S.</span><span class="si">%f</span><span class="s2">&quot;</span><span class="p">))[:</span><span class="o">-</span><span class="mi">4</span><span class="p">]</span> <span class="k">for</span> <span class="n">value</span> <span class="ow">in</span> <span class="n">values</span><span class="p">]</span>

        <span class="k">def</span> <span class="nf">int2dt</span><span class="p">(</span><span class="n">ts</span><span class="p">,</span> <span class="n">ts_mult</span><span class="o">=</span><span class="mf">1e3</span><span class="p">):</span>
            <span class="sd">&quot;&quot;&quot;Convert seconds value into datatime struct which can be used for x-axis labeeling&quot;&quot;&quot;</span>
            <span class="k">return</span> <span class="p">(</span><span class="n">datetime</span><span class="o">.</span><span class="n">utcfromtimestamp</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">ts</span><span class="p">)</span> <span class="o">/</span> <span class="n">ts_mult</span><span class="p">))</span>

<span class="k">def</span> <span class="nf">change_axis_ticks</span><span class="p">(</span> <span class="n">plot</span><span class="p">,</span> <span class="n">stylesheet</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Changes the pen and style of plot axis and labels&quot;&quot;&quot;</span>
        <span class="n">font</span> <span class="o">=</span> <span class="n">QtGui</span><span class="o">.</span><span class="n">QFont</span><span class="p">()</span>
        <span class="n">font</span><span class="o">.</span><span class="n">setPointSize</span><span class="p">(</span><span class="n">stylesheet</span><span class="p">[</span><span class="s2">&quot;pixelsize&quot;</span><span class="p">])</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s2">&quot;bottom&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tickFont</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s2">&quot;top&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tickFont</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s2">&quot;right&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tickFont</span> <span class="o">=</span> <span class="n">font</span>
        <span class="n">plot</span><span class="o">.</span><span class="n">getAxis</span><span class="p">(</span><span class="s2">&quot;left&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">tickFont</span> <span class="o">=</span> <span class="n">font</span>

<span class="k">def</span> <span class="nf">build_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">command_tuple</span><span class="p">,</span> <span class="n">single_commands</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Builds the command which needs to be send to a device correctly</span>
<span class="sd">    single_commands = True means if a list is passed the return is also a list with command value pairs&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">,</span> <span class="p">(</span><span class="nb">str</span><span class="p">)):</span>
        <span class="n">command_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">command_tuple</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># make da dummy command</span>

    <span class="k">if</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]],</span> <span class="nb">dict</span><span class="p">):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">com</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;command&quot;</span><span class="p">]</span>
            <span class="k">except</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Dict command structure recognised but no actual command found for passed order </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">com</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="p">(</span><span class="nb">str</span><span class="p">,</span> <span class="nb">float</span><span class="p">,</span> <span class="nb">int</span><span class="p">)):</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">except</span> <span class="ne">IndexError</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;You attempted to send a command with the wrong number of parameters the command structure is: </span><span class="si">{}</span><span class="s2">&quot;</span>
                               <span class="s2">&quot; but you passed: [</span><span class="si">{}</span><span class="s2">] as parameter(s)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">com</span><span class="p">,</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]))</span>

        <span class="k">elif</span> <span class="n">single_commands</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">)</span> <span class="p">:</span>
                <span class="k">return</span> <span class="p">[</span><span class="n">com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">single</span><span class="p">)</span> <span class="k">for</span> <span class="n">single</span> <span class="ow">in</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;In order to build a list command, a list has to be passed!&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">None</span>

        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">list</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="c1"># Find occurance of {} in string if list is as long as occurance of {} then just pass otherwise join a string</span>
            <span class="n">brackets_count</span> <span class="o">=</span> <span class="n">device</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span><span class="o">.</span><span class="n">count</span><span class="p">(</span><span class="s2">&quot;</span><span class="si">{}</span><span class="s2">&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="n">brackets_count</span><span class="p">:</span>
                <span class="k">return</span> <span class="n">com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="o">*</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="k">elif</span> <span class="n">brackets_count</span> <span class="o">==</span> <span class="mi">1</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">brackets_count</span><span class="p">:</span>
                <span class="n">sep</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;separator&quot;</span><span class="p">,</span> <span class="s2">&quot; &quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="n">com</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">sep</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]]))</span>
            <span class="k">elif</span> <span class="nb">len</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&gt;</span> <span class="n">brackets_count</span> <span class="ow">or</span> <span class="nb">len</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;</span> <span class="n">brackets_count</span> <span class="ow">and</span> <span class="n">brackets_count</span> <span class="o">!=</span> <span class="mi">1</span><span class="p">:</span>
                <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not build command for input length </span><span class="si">{}</span><span class="s2">&quot;</span>
                        <span class="s2">&quot; and input parameters length </span><span class="si">{}</span><span class="s2">. Input parameters must be of same length&quot;</span>
                        <span class="s2">&quot; as defined in config or 1&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]),</span>
                                                                <span class="n">brackets_count</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">None</span>
    <span class="k">else</span><span class="p">:</span>
        <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not find command </span><span class="si">{}</span><span class="s2"> in command list of device: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span>
                                                                                        <span class="n">device</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">]))</span>

<span class="k">def</span> <span class="nf">build_command_depricated</span><span class="p">(</span><span class="n">device_dict</span><span class="p">,</span> <span class="n">command_tuple</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function correctly builds the command structure for devices.</span>
<span class="sd">        You must pass the device object dictionary with all parameters and a command tuple, consisting of:</span>
<span class="sd">        Command: A command specified in the device object.</span>
<span class="sd">        Value: A string or a list of commands which are the value the command is send with. (Also possible &#39;[a,b,c]&#39; etc.)</span>

<span class="sd">        If a syntax key is present in the device object like: &#39;syntax&#39;: &#39;(@###)&#39; the char between the # will be pre and appended, to the values, respectively</span>
<span class="sd">        If a key has a corresponing CSV prepended, like get_position = pos and CSV_get_position = x,y,z, the value passed need</span>
<span class="sd">        to have at least as much values, or the missing values WILL be filled with 0. (the CSV is actually not needed, this is for security reasons, so you dont forget something)</span>
<span class="sd">        Furthermore, if a seperator key is present, you can specify how the CSV command is seperated, standard is a single space.</span>
<span class="sd">        If the key command_order is specified either with 1 or -1 the logical order of the command is reversed, so with -1</span>
<span class="sd">        the values are comming first then the actual command. When nothing is specified a 1 is assumed</span>

<span class="sd">        If you pass a list in values, all of these will be generate a return list with each list values a complete command, even when you have a different separator specified</span>
<span class="sd">        If you want a correct one specify a CSV command. Non list object will be ignored and alle appended to a long command</span>

<span class="sd">        If you just pass a string, not a tuple only the command will be returned</span>

<span class="sd">        If a terminator key is in the object, this will be automatically be appended</span>

<span class="sd">        If the key: no_syntax_with_single_commmand is prevalent, the command build (when only a string is passed)will only return the command without syntax (if specified)</span>

<span class="sd">        Return value is usually a string with the command. Except if your command consists of a list e.g you want:</span>
<span class="sd">        device_dict[command] =&gt; [&quot;comA&quot;, &quot;comB&quot;], then both commands will be build with the values and a list of both commands will be returned</span>


<span class="sd">        :param device: device dictionary</span>
<span class="sd">        :param command_tuple: (command, value), can also be a string for a final command</span>
<span class="sd">        :return string or list, depending if dict[command] is a list or a string</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="c1"># The final command which should be send in the end</span>
        <span class="n">return_list</span> <span class="o">=</span> <span class="p">[]</span> <span class="c1"># Is list of commands which can be returned if need be</span>
        <span class="n">only_command</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1"># Flag if only a command was passed, important if such a command doesnt need syntax!</span>

        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Unicode&quot;</span><span class="p">)</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">)</span><span class="o">==</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">)</span><span class="o">==</span> <span class="nb">float</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">)</span><span class="o">==</span> <span class="nb">int</span><span class="p">:</span>
            <span class="n">command_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">),</span><span class="s2">&quot;&quot;</span><span class="p">)</span> <span class="c1"># so only tuple are now prevelent</span>
            <span class="n">only_command</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span><span class="p">:</span>
            <span class="n">command_tuple</span> <span class="o">=</span> <span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="nb">str</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]])</span> <span class="c1"># so no unicode is present</span>

        <span class="c1"># Preparations</span>
        <span class="c1"># look for a syntax (paranteses and so on)</span>
        <span class="k">if</span> <span class="s2">&quot;syntax&quot;</span> <span class="ow">in</span> <span class="n">device_dict</span><span class="p">:</span>
            <span class="n">syntax</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">device_dict</span><span class="p">[</span><span class="s2">&quot;syntax&quot;</span><span class="p">])</span>
            <span class="n">syntax</span> <span class="o">=</span> <span class="n">syntax</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;###&quot;</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">syntax</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">]</span>  <span class="c1"># Most devices have no paranteses or whatsoever</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">syntax</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">]</span> <span class="c1"># Most devices have no paranteses or whatsoever</span>

        <span class="c1">#Looks if a separator is needed to sepatare mulitple orders</span>
        <span class="k">if</span> <span class="s2">&quot;separator&quot;</span> <span class="ow">in</span> <span class="n">device_dict</span><span class="p">:</span>
            <span class="n">sepa</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">device_dict</span><span class="p">[</span><span class="s2">&quot;separator&quot;</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">sepa</span> <span class="o">=</span> <span class="s2">&quot; &quot;</span> <span class="c1"># This should be the standard for most devices</span>


        <span class="k">if</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="ow">in</span> <span class="n">device_dict</span><span class="p">:</span>
            <span class="c1"># here all the magic happens</span>
            <span class="c1"># First look if the order is swichted or not (command value, or value command)</span>

            <span class="c1"># Check if multiple commands so list or so</span>
            <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">device_dict</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">device_dict</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]])</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Unicode&quot;</span><span class="p">):</span>
                <span class="n">command_list</span> <span class="o">=</span> <span class="p">[</span><span class="n">device_dict</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">command_list</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]]</span>

            <span class="k">for</span> <span class="n">command_item</span> <span class="ow">in</span> <span class="n">command_list</span><span class="p">:</span>
                <span class="n">command_item</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_item</span><span class="p">)</span>
                <span class="n">command</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>

                <span class="c1"># Value -&gt; Command</span>
                <span class="k">if</span> <span class="nb">int</span><span class="p">(</span><span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;command_order&quot;</span><span class="p">,</span> <span class="mi">1</span><span class="p">))</span> <span class="o">==</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                    <span class="c1"># Now look if a csv structure is necessary for the command to work</span>
                    <span class="n">start_ind</span> <span class="o">=</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span>  <span class="c1"># finds the index of the command, to search for</span>
                    <span class="k">if</span> <span class="s2">&quot;CSV&quot;</span> <span class="o">+</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start_ind</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">device_dict</span><span class="p">:</span>  <span class="c1"># looks if an actual csv-command is there</span>
                        <span class="c1"># Todo: test CSV command</span>
                        <span class="n">csv_commands</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s2">&quot;CSV&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">start_ind</span><span class="p">:]]</span>
                        <span class="n">csv_commands</span> <span class="o">=</span> <span class="n">csv_commands</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># get rid of some caracters which should not be there</span>
                        <span class="n">csv_commands</span> <span class="o">=</span> <span class="n">csv_commands</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>  <span class="c1"># now split it for easy access</span>

                        <span class="c1"># Make sure you always got a list of the next commandblock will fail</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">value_list</span> <span class="o">=</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">)</span> <span class="o">==</span> <span class="nb">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Unicode&quot;</span><span class="p">):</span>
                            <span class="n">value_list</span> <span class="o">=</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">value_list</span> <span class="o">=</span> <span class="n">value_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

                        <span class="n">csv_list</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">value_list</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">csv_list</span> <span class="o">=</span> <span class="n">csv_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">com</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csv_list</span><span class="p">):</span>
                            <span class="c1"># here the input will be checked if enough parameters are passed for this command.</span>
                            <span class="c1"># If not a 0 will be entered and a warning will be printed</span>
                            <span class="n">command</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">csv_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">sepa</span>

                        <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)):</span>  <span class="c1"># Fill the rest of the missing paramters</span>
                                <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Warning: Not enough parameters passed for function: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; the command must consist of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39; is missing! Inserted 0 instead.&quot;</span><span class="p">)</span>
                                <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">sepa</span>

                        <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>  <span class="c1"># to get rid of last comma</span>

                    <span class="k">else</span><span class="p">:</span>  <span class="c1"># So if no CSV was found for this command, just build the command with the value and the separator</span>
                        <span class="c1"># First check if a List is present or so</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">command</span> <span class="o">=</span>  <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">command_item</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="c1"># Add a command terminator if one is needed and the last part of the syntax</span>
                                <span class="n">command</span> <span class="o">+=</span> <span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_terminator&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">return_list</span>

                        <span class="k">else</span><span class="p">:</span> <span class="c1"># If only a command was passed</span>
                            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">command</span> <span class="o">+=</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">only_command</span> <span class="ow">and</span> <span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;no_syntax_with_single_commmand&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span> <span class="s2">&quot; &quot;</span> <span class="ow">and</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                    <span class="c1">#command += &quot; &quot; + str(device_dict[str(command_item)]).strip() + syntax[0]  # adds the order to the command</span>
                    <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_item</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>  <span class="c1"># adds the order to the command</span>
                    <span class="c1"># Add a command terminator if one is needed and the last part of the syntax</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">command</span> <span class="o">+=</span> <span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_terminator&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="c1">#command += syntax[0]  # adds the order to the command</span>
                    <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>

                <span class="c1">#Command -&gt; Value</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">command</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_item</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="c1"># adds the order to the command</span>

                    <span class="c1"># Now look if a csv structure is necessary for the command to work</span>
                    <span class="n">start_ind</span> <span class="o">=</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">find</span><span class="p">(</span><span class="s2">&quot;_&quot;</span><span class="p">)</span> <span class="c1"># finds the index of the command, to search for</span>
                    <span class="k">if</span> <span class="s2">&quot;CSV&quot;</span> <span class="o">+</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">][</span><span class="n">start_ind</span><span class="p">:]</span> <span class="ow">in</span> <span class="n">device_dict</span><span class="p">:</span> <span class="c1"># looks if an actual csv-command is there</span>
                        <span class="c1">#Todo: test CSV command</span>
                        <span class="n">csv_commands</span> <span class="o">=</span> <span class="n">device_dict</span><span class="p">[</span><span class="s2">&quot;CSV&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])[</span><span class="n">start_ind</span><span class="p">:]]</span>
                        <span class="n">csv_commands</span> <span class="o">=</span> <span class="n">csv_commands</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="c1"># get rid of some caracters which should not be there</span>
                        <span class="n">csv_commands</span> <span class="o">=</span> <span class="n">csv_commands</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>  <span class="c1"># now split it for easy access</span>

                        <span class="c1"># Make sure you always got a list of the next commandblock will fail</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">value_list</span> <span class="o">=</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                        <span class="k">elif</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span><span class="o">==</span><span class="nb">str</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="sa">u</span><span class="s2">&quot;Unicode&quot;</span><span class="p">):</span>
                            <span class="n">value_list</span> <span class="o">=</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                            <span class="n">value_list</span> <span class="o">=</span> <span class="n">value_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>


                        <span class="n">csv_list</span> <span class="o">=</span> <span class="s2">&quot;,&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="nb">map</span><span class="p">(</span><span class="nb">str</span><span class="p">,</span><span class="n">value_list</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;(&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;)&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;[&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;]&quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                        <span class="n">csv_list</span> <span class="o">=</span> <span class="n">csv_list</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span>

                        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">com</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">csv_list</span><span class="p">):</span>
                            <span class="c1"># here the input will be checked if enough parameters are passed for this command.</span>
                            <span class="c1"># If not a 0 will be entered and a warning will be printed</span>
                            <span class="n">command</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="n">csv_list</span><span class="p">[</span><span class="n">i</span><span class="p">])</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">sepa</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span>

                        <span class="k">if</span> <span class="n">i</span><span class="o">+</span><span class="mi">1</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)</span> <span class="ow">and</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)</span><span class="o">&gt;</span><span class="mi">1</span><span class="p">:</span>
                            <span class="k">for</span> <span class="n">j</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)):</span><span class="c1"># Fill the rest of the missing paramters</span>
                                <span class="n">l</span><span class="o">.</span><span class="n">warning</span><span class="p">(</span><span class="s2">&quot;Not enough parameters passed for function: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; the command must consist of &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &#39;&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">csv_commands</span><span class="p">[</span><span class="n">j</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;&#39; is missing! Inserted 0 instead.&quot;</span><span class="p">)</span>
                                <span class="n">command</span> <span class="o">+=</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="s2">&quot;0&quot;</span> <span class="o">+</span> <span class="n">sepa</span>

                        <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)</span> <span class="c1"># to get rid of last comma and space at the end if csv</span>
                        <span class="n">command</span> <span class="o">+=</span>  <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>

                    <span class="k">else</span><span class="p">:</span> <span class="c1"># So if no CSV was found for this command, just build the command with the value and the separator</span>
                        <span class="c1"># First check if a List is present or so</span>
                        <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">list</span> <span class="ow">or</span> <span class="nb">type</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span> <span class="o">==</span> <span class="nb">tuple</span><span class="p">:</span>
                            <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;&quot;</span>
                            <span class="k">for</span> <span class="n">item</span> <span class="ow">in</span> <span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">]:</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">item</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; &quot;</span> <span class="o">+</span> <span class="n">command_item</span> <span class="o">+</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                                <span class="c1"># Add a command terminator if one is needed and the last part of the syntax</span>
                                <span class="n">command</span> <span class="o">+=</span> <span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_terminator&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="p">)</span>
                            <span class="k">return</span> <span class="n">return_list</span>

                        <span class="k">else</span><span class="p">:</span> <span class="c1"># If its just one value or no value</span>
                            <span class="n">string</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="n">command</span> <span class="o">+=</span> <span class="n">string</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="o">+</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
                            <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>

                            <span class="k">if</span> <span class="n">only_command</span> <span class="ow">and</span> <span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;no_syntax_with_single_commmand&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span> <span class="ow">and</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span><span class="o">!=</span> <span class="s2">&quot; &quot;</span> <span class="ow">and</span> <span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">!=</span> <span class="s2">&quot; &quot;</span><span class="p">:</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">syntax</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                                <span class="n">command</span> <span class="o">=</span> <span class="n">command</span><span class="o">.</span><span class="n">replace</span><span class="p">(</span><span class="n">syntax</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>

                            <span class="c1"># Add a command terminator if one is needed and the last part of the syntax</span>
                            <span class="n">command</span> <span class="o">+=</span> <span class="n">device_dict</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_terminator&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                    <span class="n">return_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">command</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="c1"># If the command is not found in the device only command tuple will be send</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Command &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">command_tuple</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; was not found in device! Unpredictable behavior may happen. No commad build!&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="s2">&quot;&quot;</span>

        <span class="c1"># Add a command terminator if one is needed and the last part of the syntax</span>
        <span class="c1">#command += device_dict.get(&quot;execution_terminator&quot;,&quot;&quot;)</span>



        <span class="c1"># Todo: multiple commands return</span>
        <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">return_list</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span>
            <span class="k">return</span> <span class="n">return_list</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">return</span> <span class="nb">str</span><span class="p">(</span><span class="n">return_list</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

<span class="c1">#class newThread(threading.Thread):  # This class inherite the functions of the threading class</span>
<span class="k">class</span> <span class="nc">newThread</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">):</span>  <span class="c1"># This class inherite the functions of the threading class</span>
    <span class="sd">&#39;&#39;&#39;Creates new threads easy, it needs the thread ID a name, the function/class,</span>
<span class="sd">    which should run in a seperated thread and the arguments passed to the object&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">object__</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>  <span class="c1"># Init where the threadID and Thread Name are defined</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param threadID: ID the thread should have</span>
<span class="sd">        :param name: Give the thread a name you want</span>
<span class="sd">        :param object__: The object which should run in the new thread</span>
<span class="sd">        :param args: Arguments passed to object__</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Opens the threading class</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threadID</span> <span class="o">=</span> <span class="n">threadID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object__</span><span class="o">=</span> <span class="n">object__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Initialized new thread with ID: </span><span class="si">{!s}</span><span class="s2">, Name: </span><span class="si">{!s}</span><span class="s2"> and Object: </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">threadID</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">object__</span><span class="p">))</span>

    <span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object__</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span> <span class="c1"># Just for clarification, not necessary.</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">return</span> <span class="n">object__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Starts running the thread&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting thread: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">get</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;returns the Object&#39;&#39;&#39;</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">object__</span>

<span class="k">class</span> <span class="nc">newThread_</span><span class="p">(</span><span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="p">):</span>  <span class="c1"># This class inherite the functions of the threading class</span>
    <span class="sd">&#39;&#39;&#39;Creates new threads easy, it needs the thread ID, a name, the function/class, which should run in a seperated thread</span>
<span class="sd">    This is the same thing like newThread but instead QTCore modules are used.&#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">threadID</span><span class="p">,</span> <span class="n">name</span><span class="p">,</span> <span class="n">object__</span><span class="p">,</span> <span class="o">*</span><span class="n">args</span><span class="p">):</span>  <span class="c1"># Init where the threadID and Thread Name are defined</span>

        <span class="n">QtCore</span><span class="o">.</span><span class="n">QThread</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>  <span class="c1"># Opens the threading class</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">threadID</span> <span class="o">=</span> <span class="n">threadID</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">name</span> <span class="o">=</span> <span class="n">name</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object__</span><span class="o">=</span> <span class="n">object__</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">args</span> <span class="o">=</span> <span class="n">args</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run_process</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">object__</span><span class="p">,</span> <span class="n">args</span><span class="p">):</span> <span class="c1"># Just for clarification, not necessary.</span>
        <span class="k">return</span> <span class="n">object__</span><span class="p">(</span><span class="o">*</span><span class="n">args</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="c1"># run() is a member function of Thread() class. This will be called, when object thread will be started via thread.start()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting thread: &quot;</span> <span class="o">+</span> <span class="bp">self</span><span class="o">.</span><span class="n">name</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">object__</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">run_process</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">object__</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">args</span><span class="p">)</span>

    <span class="nd">@staticmethod</span>
    <span class="k">def</span> <span class="nf">get</span><span class="p">():</span>
        <span class="sd">&#39;&#39;&#39;returns the Object&#39;&#39;&#39;</span> <span class="c1"># Not working, do not use</span>
        <span class="n">newThread_</span><span class="o">.</span><span class="n">object__</span><span class="p">()</span>

<span class="k">class</span> <span class="nc">LogFile</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This class handles the Logfile for the whole framework</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">path</span><span class="o">=</span><span class="s1">&#39;logger.yml&#39;</span><span class="p">,</span> <span class="n">default_level</span><span class="o">=</span><span class="n">logging</span><span class="o">.</span><span class="n">INFO</span><span class="p">,</span> <span class="n">env_key</span><span class="o">=</span><span class="s1">&#39;LOG_CFG&#39;</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Initiates the logfile with the logging level</span>
<span class="sd">        :param path: Path to logger file</span>
<span class="sd">        :param logging_level: None, debug, info, warning, error critical</span>
<span class="sd">        :param env_key: env_key</span>
<span class="sd">        &quot;&quot;&quot;</span>


        <span class="n">value</span> <span class="o">=</span> <span class="n">os</span><span class="o">.</span><span class="n">getenv</span><span class="p">(</span><span class="n">env_key</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">value</span><span class="p">:</span>
            <span class="n">path</span> <span class="o">=</span> <span class="n">value</span>
        <span class="k">if</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">exists</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">normpath</span><span class="p">(</span><span class="n">path</span><span class="p">)):</span>
            <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
                <span class="n">config</span> <span class="o">=</span> <span class="n">yaml</span><span class="o">.</span><span class="n">safe_load</span><span class="p">(</span><span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
                <span class="c1"># If directory is non existent create it</span>
                <span class="c1"># Todo: Here a dir will be made after installation, so if this prohibited go to the other dir</span>
                <span class="n">pathtologfile</span> <span class="o">=</span> <span class="n">config</span><span class="p">[</span><span class="s2">&quot;handlers&quot;</span><span class="p">][</span><span class="s2">&quot;file&quot;</span><span class="p">][</span><span class="s2">&quot;filename&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">isdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="o">*</span><span class="n">pathtologfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">])):</span>
                    <span class="n">os</span><span class="o">.</span><span class="n">mkdir</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">getcwd</span><span class="p">(),</span><span class="o">*</span><span class="n">pathtologfile</span><span class="p">[:</span><span class="o">-</span><span class="mi">1</span><span class="p">]))</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">config</span><span class="o">.</span><span class="n">dictConfig</span><span class="p">(</span><span class="n">config</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">logging</span><span class="o">.</span><span class="n">basicConfig</span><span class="p">(</span><span class="n">level</span><span class="o">=</span><span class="n">default_level</span><span class="p">)</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log_LEVELS</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;NOTSET&quot;</span><span class="p">:</span> <span class="mi">0</span><span class="p">,</span> <span class="s2">&quot;DEBUG&quot;</span><span class="p">:</span> <span class="mi">10</span><span class="p">,</span> <span class="s2">&quot;INFO&quot;</span><span class="p">:</span> <span class="mi">20</span><span class="p">,</span> <span class="s2">&quot;WARNING&quot;</span><span class="p">:</span> <span class="mi">30</span><span class="p">,</span> <span class="s2">&quot;ERROR&quot;</span><span class="p">:</span> <span class="mi">40</span><span class="p">,</span> <span class="s2">&quot;CRITICAL&quot;</span><span class="p">:</span> <span class="mi">50</span><span class="p">}</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">welcome_string</span> <span class="o">=</span>  <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span> \
                               <span class="s2">&quot;</span><span class="se">\t\t\t\t\t\t\t\t</span><span class="s2">  __         ______     ______     ______   __     __         ______           ______     ______   ______</span><span class="se">\n</span><span class="s2">  </span><span class="se">\</span>
<span class="s2">                               /\ \       /\  __ \   /\  ___\   /\  ___\ /\ \   /\ \       /\  ___\         /\  __ \   /\__  _\ /\  ___\ </span><span class="se">\n</span><span class="s2">   </span><span class="se">\</span>
<span class="s2">                              \ \ \____  \ \ \/\ \  \ \ \__ \  \ \  __\ \ \ \  \ \ \____  \ \  __\         \ \ \/\_\  \/_/\ \/ \ \ \____ </span><span class="se">\n</span><span class="s2">  </span><span class="se">\</span>
<span class="s2">                                \ \_____\  \ \_____\  \ \_____\  \ \_\    \ \_\  \ \_____\  \ \_____\        \ \___\_\    \ \_\  \ \_____\ </span><span class="se">\n</span><span class="s2"> </span><span class="se">\</span>
<span class="s2">                                  \/_____/   \/_____/   \/_____/   \/_/     \/_/   \/_____/   \/_____/         \/___/_/     \/_/   \/_____</span><span class="se">\n\n\n</span><span class="s2">&quot;</span>

        <span class="c1"># Create a logger Object</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LOG</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;Logfile&quot;</span><span class="p">)</span>
        <span class="c1"># Print welcome message</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">LOG</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">welcome_string</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">Framework</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Generall class for handling all Framework related tasks, like updating the GUI etc.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">values_from_GUI</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        :param values_from_GUI: A tuple of (list of functions, udate intervall)</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">update_interval</span> <span class="o">=</span> <span class="n">values_from_GUI</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;Framework&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">start_timer</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>  <span class="c1"># Bug timer gets not called due to a lock somewhere else</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Simply starts the timer</span>

<span class="sd">        :return: timer</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Framework initialized...&quot;</span><span class="p">)</span>
        <span class="n">timer</span> <span class="o">=</span> <span class="n">QtCore</span><span class="o">.</span><span class="n">QTimer</span><span class="p">()</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">timeout</span><span class="o">.</span><span class="n">connect</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_</span><span class="p">)</span>
        <span class="n">timer</span><span class="o">.</span><span class="n">start</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">update_interval</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">timer</span> <span class="o">=</span> <span class="n">timer</span>
        <span class="k">return</span> <span class="n">timer</span>

    <span class="k">def</span> <span class="nf">update_</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Periodically updates the functions in self.functions list</span>

<span class="sd">        :return: None</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">for</span> <span class="n">function</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">functions</span><span class="p">:</span>
            <span class="k">try</span><span class="p">:</span>
                <span class="n">function</span><span class="p">()</span>
            <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;While updating the framework an error happend in function </span><span class="si">{}</span><span class="s2"> with error: </span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">function</span><span class="p">,</span> <span class="n">err</span><span class="p">))</span>

<span class="k">class</span> <span class="nc">transformation</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Class which handles afine transformations in 3 dimensions for handling sensor to jig coordinate systems&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="nd">@raise_exception</span>
    <span class="k">def</span> <span class="nf">transformation_matrix</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">s1</span><span class="p">,</span> <span class="n">s2</span><span class="p">,</span> <span class="n">s3</span><span class="p">,</span> <span class="n">t1</span><span class="p">,</span> <span class="n">t2</span> <span class="p">,</span><span class="n">t3</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Calculates the transformation matrix of the system.</span>
<span class="sd">        Via the equation T = P^-1 Q where P and Q are coming from the linear system s*T + V0 = v</span>
<span class="sd">        si are the corresponding vectors (coordinates) in the sensor system, ti are those from the table system.</span>
<span class="sd">        They must be numpy arrays.</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="n">s1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s1</span><span class="p">)</span>
        <span class="n">s2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s2</span><span class="p">)</span>
        <span class="n">s3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">s3</span><span class="p">)</span>
        <span class="n">t1</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t1</span><span class="p">)</span>
        <span class="n">t2</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t2</span><span class="p">)</span>
        <span class="n">t3</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">t3</span><span class="p">)</span>

        <span class="n">Q</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                    <span class="p">[</span><span class="n">t2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t2</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span><span class="p">[</span><span class="mi">2</span><span class="p">]],</span>
                    <span class="p">[</span><span class="n">t3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">t3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">t3</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-</span> <span class="n">t1</span><span class="p">[</span><span class="mi">2</span><span class="p">]]</span>
        <span class="p">])</span>

        <span class="n">P</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">([</span>
                    <span class="p">[</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s2</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]],</span>
                    <span class="p">[</span><span class="n">s3</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">-</span> <span class="n">s1</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">s3</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">-</span> <span class="n">s1</span><span class="p">[</span><span class="mi">1</span><span class="p">]]</span>
        <span class="p">])</span>


        <span class="k">try</span><span class="p">:</span>
            <span class="c1"># Invert the P matrix</span>
            <span class="n">Pinv</span> <span class="o">=</span> <span class="n">inv</span><span class="p">(</span><span class="n">P</span><span class="p">)</span>

            <span class="c1"># Build the dot product</span>
            <span class="n">T</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">Pinv</span><span class="p">,</span> <span class="n">Q</span><span class="p">)</span>

            <span class="c1"># Offset</span>
            <span class="n">V0</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">subtract</span><span class="p">(</span><span class="n">t2</span><span class="p">,</span><span class="n">np</span><span class="o">.</span><span class="n">transpose</span><span class="p">(</span><span class="n">s2</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">])</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="p">))</span>
        <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;An error occured during the transformation with error: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">e</span><span class="p">))</span>
            <span class="k">return</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span> <span class="o">-</span><span class="mi">1</span>

        <span class="k">return</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span>

    <span class="k">def</span> <span class="nf">vector_trans</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">v</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;This function transforms a Vector from the sensor system to the table system by vs*T+V0=vt&quot;&quot;&quot;</span>
        <span class="n">v</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">array</span><span class="p">(</span><span class="n">v</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">np</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">v</span><span class="p">[</span><span class="mi">0</span><span class="p">:</span><span class="mi">2</span><span class="p">]</span><span class="o">.</span><span class="n">dot</span><span class="p">(</span><span class="n">T</span><span class="p">),</span><span class="n">V0</span><span class="p">)</span>

<span class="k">class</span> <span class="nc">table_control_class</span><span class="p">:</span>
    <span class="sd">&#39;&#39;&#39;This class handles all interactions with the table. Movement, status etc.</span>
<span class="sd">    This class is designed to be running in different instances.</span>

<span class="sd">    :param main_variables: Defaults dict</span>
<span class="sd">    :param device: The VISA device object</span>
<span class="sd">    :param queue_to_GUI: Queue object to the main</span>
<span class="sd">    :param vcw: A VISA connect wizard instance</span>
<span class="sd">    &#39;&#39;&#39;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_variables</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">queue_to_GUI</span><span class="p">,</span> <span class="n">vcw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param main_variables: Defaults dict</span>
<span class="sd">        :param device: The VISA device object</span>
<span class="sd">        :param queue_to_GUI:</span>
<span class="sd">        :param vcw: A VISA connect wizard instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">variables</span> <span class="o">=</span> <span class="n">main_variables</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devices</span> <span class="o">=</span> <span class="n">devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">device</span> <span class="o">=</span> <span class="n">devices</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Table_control&quot;</span><span class="p">,</span> <span class="kc">None</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;table_ready&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">queue</span> <span class="o">=</span> <span class="n">queue_to_GUI</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span> <span class="o">=</span> <span class="n">vcw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span> <span class="o">=</span> <span class="n">build_command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="s2">&quot;Table_control&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">pos_pattern</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">compile</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;(-?\d+.\d+)\s+(-?\d+.\d+)\s+(-?\d+.\d+)&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">lifting</span> <span class="o">=</span> <span class="mi">800</span>

        <span class="k">if</span> <span class="s2">&quot;Table_control&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">if</span> <span class="s2">&quot;Visa_Resource&quot;</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s2">&quot;Table_control&quot;</span><span class="p">]:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">visa_resource</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="s2">&quot;Table_control&quot;</span><span class="p">][</span><span class="s2">&quot;Visa_Resource&quot;</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_ready&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">zmove</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;height_movement&quot;</span><span class="p">]</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span> <span class="o">=</span> <span class="kc">False</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Table control could not be initialized! Visa Resource missing&quot;</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span> <span class="o">=</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">get_current_position</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;Queries the current position of the table and writes it to the state machine&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span><span class="p">:</span>
            <span class="n">max_attempts</span> <span class="o">=</span> <span class="mi">0</span>
            <span class="k">while</span> <span class="n">max_attempts</span> <span class="o">&lt;</span> <span class="mi">3</span><span class="p">:</span> <span class="c1"># Loop as long as there is a valid position from the corvus</span>
                <span class="k">try</span><span class="p">:</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="s2">&quot;Error&quot;</span>
                    <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;get_position&quot;</span><span class="p">)</span>
                    <span class="n">string</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                    <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pos_pattern</span><span class="o">.</span><span class="n">findall</span><span class="p">(</span><span class="n">string</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;x_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;y_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;z_pos&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                    <span class="k">return</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="n">pos</span><span class="p">]</span>
                <span class="k">except</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The corvus has replied with a non valid position string: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">string</span><span class="p">))</span>
                    <span class="n">max_attempts</span> <span class="o">+=</span> <span class="mi">1</span>

    <span class="k">def</span> <span class="nf">check_if_ready</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">timeout</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">maxcounter</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function checks if the movement of the table is done or not</span>

<span class="sd">        :param timeout: Timeout how long to wait between the attempts</span>
<span class="sd">        :param maxcounter: How often does the function try to get an answer, -1 infinite</span>
<span class="sd">        :return: 0 if ok error if not</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Alot of time can be wasted by the timeout of the visa read order</span>
        <span class="n">ready_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;get_all_done&quot;</span><span class="p">)</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span> <span class="c1"># counter how often the read attempt will be carried out</span>
        <span class="n">cal_not_done</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">ready_command</span><span class="p">)</span>
        <span class="k">while</span> <span class="n">cal_not_done</span><span class="p">:</span>
            <span class="n">done</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">read</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">done</span><span class="p">:</span>
                <span class="n">done</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">done</span><span class="o">.</span><span class="n">strip</span><span class="p">())</span>

            <span class="k">if</span> <span class="n">maxcounter</span> <span class="o">!=</span> <span class="o">-</span><span class="mi">1</span><span class="p">:</span>
                <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>
                <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="n">maxcounter</span><span class="p">:</span>
                    <span class="n">cal_not_done</span> <span class="o">=</span> <span class="kc">False</span> <span class="c1">#exits the loop after some attempts</span>

            <span class="c1"># todo: very bad coding here</span>
            <span class="k">elif</span> <span class="n">done</span> <span class="o">==</span> <span class="kc">False</span> <span class="ow">and</span> <span class="nb">str</span><span class="p">(</span><span class="n">done</span><span class="p">)</span> <span class="o">!=</span> <span class="s2">&quot;0.0&quot;</span><span class="p">:</span>
                <span class="k">pass</span>

            <span class="k">elif</span> <span class="n">done</span> <span class="o">==</span> <span class="mf">1.</span><span class="p">:</span> <span class="c1"># motors are in movement</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">ready_command</span><span class="p">)</span> <span class="c1"># writes the command again</span>

            <span class="k">elif</span> <span class="n">done</span> <span class="o">==</span> <span class="mf">2.</span><span class="p">:</span> <span class="c1"># joystick active</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Joystick of table control is active.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">done</span> <span class="o">==</span> <span class="mf">4.</span><span class="p">:</span> <span class="c1"># joystick active</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Table control is not switched on.&quot;</span><span class="p">)</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">done</span> <span class="o">&gt;</span> <span class="mf">4.</span><span class="p">:</span> <span class="c1"># joystick active</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The table control reported an unknown error, with errorcode: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">done</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="k">elif</span> <span class="n">done</span> <span class="o">==</span> <span class="mf">0.</span><span class="p">:</span> <span class="c1"># when corvus is read again</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">()</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="n">QApplication</span><span class="o">.</span><span class="n">processEvents</span><span class="p">()</span> <span class="c1"># Updates the GUI, maybe after some iterations</span>
            <span class="n">sleep</span><span class="p">(</span><span class="n">timeout</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">initiate_table</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function triggers the table initiation</span>

<span class="sd">        :return: 0 if ok error if not</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>
            <span class="n">commands</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;calibrate_motor&quot;</span><span class="p">]</span>
            <span class="k">for</span> <span class="n">order</span> <span class="ow">in</span> <span class="n">commands</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">order</span><span class="p">)</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_if_ready</span><span class="p">()</span>
                <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">()</span>
                        <span class="k">if</span> <span class="n">commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span> <span class="o">==</span> <span class="n">order</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;table_xmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;table_ymin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;table_zmin&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                        <span class="k">else</span><span class="p">:</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;table_xmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;table_ymax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
                            <span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;table_zmax&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">2</span><span class="p">])</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="n">success</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;An error occured while trying to initiate the table. This can happen if either no &quot;</span>
                           <span class="s2">&quot;Table is connected to the setup OR the table is currently moving.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">check_position</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">desired_pos</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function checks if two positions are equal or not</span>

<span class="sd">        :param desired_pos: The position it should be</span>
<span class="sd">        :return: True if ok</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">new_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">()</span>
        <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">pos</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">new_pos</span><span class="p">):</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">(</span><span class="nb">float</span><span class="p">(</span><span class="n">pos</span><span class="p">)</span> <span class="o">-</span> <span class="nb">float</span><span class="p">(</span><span class="n">desired_pos</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="o">&gt;</span> <span class="mf">0.5</span><span class="p">:</span> <span class="c1"># up to a half micrometer</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Table movement failed. Position: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">new_pos</span><span class="p">)</span> <span class="o">+</span> <span class="s2">&quot; is not equal to desired position: &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">desired_pos</span><span class="p">))</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">__already_there</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_file</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">transfomation_class</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Checks if we are already at the strip we want to move to</span>

<span class="sd">        :param pad_file:</span>
<span class="sd">        :param strip:</span>
<span class="sd">        :param transfomation_class:</span>
<span class="sd">        :param T:</span>
<span class="sd">        :param V0:</span>
<span class="sd">        :return: True if at strip</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">()</span>  <span class="c1"># table position</span>
        <span class="n">pad_pos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">pad_file</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="nb">str</span><span class="p">(</span><span class="n">strip</span><span class="p">)]]</span>  <span class="c1"># where it should be in sensor system</span>
        <span class="n">table_pos</span> <span class="o">=</span> <span class="n">transfomation_class</span><span class="o">.</span><span class="n">vector_trans</span><span class="p">(</span><span class="n">pad_pos</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span><span class="p">)</span>  <span class="c1"># Transforms the vektor to the right basis</span>
        <span class="n">deltapos</span> <span class="o">=</span> <span class="p">[</span><span class="nb">abs</span><span class="p">(</span><span class="n">x1</span> <span class="o">-</span> <span class="n">x2</span><span class="p">)</span> <span class="k">for</span> <span class="p">(</span><span class="n">x1</span><span class="p">,</span> <span class="n">x2</span><span class="p">)</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">pos</span><span class="p">,</span> <span class="n">table_pos</span><span class="p">)]</span>

        <span class="k">for</span> <span class="n">delta</span> <span class="ow">in</span> <span class="n">deltapos</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">delta</span> <span class="o">&gt;=</span> <span class="mf">0.5</span><span class="p">:</span>  <span class="c1"># Checks if the position is correct in a range of 0.5 um</span>
                <span class="k">return</span> <span class="kc">False</span>
        <span class="k">return</span> <span class="kc">True</span>


    <span class="k">def</span> <span class="nf">move_to_strip</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pad_file</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">transfomation_class</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span><span class="p">,</span> <span class="n">height_movement</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Moves to a specific strip</span>

<span class="sd">        :param transfomation_class:</span>
<span class="sd">        :param height_movement: How much should the table move down</span>
<span class="sd">        :return: None or errorcode</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">transformation</span> <span class="o">!=</span> <span class="p">[]:</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">__already_there</span><span class="p">(</span><span class="n">pad_file</span><span class="p">,</span> <span class="n">strip</span><span class="p">,</span> <span class="n">transfomation_class</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span><span class="p">):</span>
                <span class="n">pad_pos</span> <span class="o">=</span> <span class="n">pad_file</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">strip</span><span class="p">]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Moving to strip: </span><span class="si">{}</span><span class="s2"> at position </span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">,</span><span class="si">{}</span><span class="s2">.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">strip</span><span class="p">,</span> <span class="n">pad_pos</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">pad_pos</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">pad_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]))</span>
                <span class="n">table_abs_pos</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">transfomation_class</span><span class="o">.</span><span class="n">vector_trans</span><span class="p">(</span><span class="n">pad_pos</span><span class="p">,</span> <span class="n">T</span><span class="p">,</span> <span class="n">V0</span><span class="p">))</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">table_abs_pos</span><span class="p">,</span> <span class="n">move_down</span><span class="o">=</span><span class="kc">True</span><span class="p">,</span> <span class="n">lifting</span> <span class="o">=</span> <span class="n">height_movement</span><span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">True</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;current_strip&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">strip</span>
            <span class="k">return</span> <span class="n">success</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No Transformation Matrix found! Is the alignment done?&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>


    <span class="k">def</span> <span class="nf">relative_move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">move_down</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">lifting</span> <span class="o">=</span> <span class="mi">800</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function moves the table to the desired position (relative). position is a list of coordinates</span>
<span class="sd">        The move down parameter can prohibit a down and up movement with the move, !!!!USE WITH CARE!!!!</span>

<span class="sd">        :return: none or error code</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">(</span><span class="n">position</span><span class="p">,</span> <span class="n">move_down</span><span class="p">,</span> <span class="n">lifting</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">success</span>


    <span class="k">def</span> <span class="nf">move_to</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">position</span><span class="p">,</span> <span class="n">move_down</span> <span class="o">=</span> <span class="kc">True</span><span class="p">,</span> <span class="n">lifting</span>  <span class="o">=</span> <span class="mi">800</span><span class="p">,</span> <span class="n">relative_move</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function moves the table to the desired position. position is a list of coordinates</span>
<span class="sd">        The move down parameter can prohibits a down and up movement with the move, !!!!USE WITH CARE!!!!</span>

<span class="sd">        :return: None or errorcode</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Try moving table to </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span> <span class="ow">and</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]:</span>
            <span class="c1"># get me the current position</span>
            <span class="n">old_pos</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">get_current_position</span><span class="p">()</span>
            <span class="n">desired_pos</span> <span class="o">=</span> <span class="n">position</span><span class="p">[:]</span>

            <span class="c1">#Move the table down if necessary</span>
            <span class="k">if</span> <span class="n">move_down</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_down</span><span class="p">(</span><span class="n">lifting</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">relative_move</span><span class="p">:</span>
                    <span class="n">desired_pos</span><span class="p">[</span><span class="mi">2</span><span class="p">]</span> <span class="o">-=</span> <span class="n">lifting</span> <span class="c1"># To counter the down movement</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Change the state of the table</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span>

            <span class="c1"># Move the table to the position</span>
            <span class="k">if</span> <span class="n">relative_move</span><span class="p">:</span>
                <span class="n">move_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_relative_move_to&quot;</span><span class="p">,</span> <span class="n">desired_pos</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">move_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_move_to&quot;</span><span class="p">,</span> <span class="n">desired_pos</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">move_command</span><span class="p">)</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_if_ready</span><span class="p">()</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># State that the table is not moving anymore</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>

            <span class="c1"># Move the table back up again</span>
            <span class="k">if</span> <span class="n">move_down</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_up</span><span class="p">(</span><span class="n">lifting</span><span class="p">)</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">False</span>

            <span class="c1"># Finally make sure the position is correct</span>
            <span class="k">if</span> <span class="n">relative_move</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_position</span><span class="p">([</span><span class="nb">sum</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">old_pos</span><span class="p">,</span> <span class="n">position</span><span class="p">)])</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_position</span><span class="p">(</span><span class="n">position</span><span class="p">)</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">success</span><span class="p">:</span>
                <span class="k">return</span> <span class="kc">False</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;table_is_moving&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Successfully moved table to </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">position</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Table could not be moved due to an error. This usually happens if no table is connected to&quot;</span>
                           <span class="s2">&quot; the setup OR the table is currently moving.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

    <span class="k">def</span> <span class="nf">move_up</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lifting</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function moves the table up</span>

<span class="sd">        :param lifting:  hight movement</span>
<span class="sd">        :return: none or errorcode</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Moving table up by </span><span class="si">{!s}</span><span class="s2"> microns&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lifting</span><span class="p">))</span>
        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;Table_state&quot;</span><span class="p">]:</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="n">lifting</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;Table_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">True</span> <span class="c1"># true means up</span>
            <span class="k">return</span> <span class="n">success</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s2">&quot;Info&quot;</span><span class="p">:</span> <span class="s2">&quot;Table already in the up position...&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">move_down</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">lifting</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function moves the table down</span>

<span class="sd">        :param lifting:  hight movement</span>
<span class="sd">        :return: none or errorcode</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Moving table down by </span><span class="si">{!s}</span><span class="s2"> microns&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">lifting</span><span class="p">))</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;Table_state&quot;</span><span class="p">]:</span>
            <span class="n">success</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">move_to</span><span class="p">([</span><span class="mi">0</span><span class="p">,</span><span class="mi">0</span><span class="p">,</span><span class="o">-</span><span class="n">lifting</span><span class="p">],</span> <span class="kc">False</span><span class="p">,</span> <span class="mi">0</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span>
            <span class="k">if</span> <span class="n">success</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">variables</span><span class="p">[</span><span class="s2">&quot;Table_state&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="n">success</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">queue</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s2">&quot;Info&quot;</span><span class="p">:</span> <span class="s2">&quot;Table already in the down position...&quot;</span><span class="p">})</span>
        <span class="k">return</span> <span class="kc">True</span>

    <span class="k">def</span> <span class="nf">set_joystick</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">bool</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This enables or disables the joystick&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">bool</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_joystick&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_joystick&quot;</span><span class="p">,</span> <span class="s2">&quot;0&quot;</span><span class="p">))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_joystick_speed</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">speed</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This sets the speed for the joystick&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_joy_speed&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">speed</span><span class="p">)))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">set_axis</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">axis_list</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This sets the axis on or off. axis_list must contain a list of type [x=bool, y=bool, z=bool]&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span><span class="p">:</span>
            <span class="n">final_axis_list</span> <span class="o">=</span> <span class="p">[]</span>
            <span class="k">for</span> <span class="n">i</span><span class="p">,</span> <span class="n">axis</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">axis_list</span><span class="p">):</span>
                <span class="k">if</span> <span class="n">axis</span><span class="p">:</span>
                    <span class="n">final_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;1 &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="n">final_axis_list</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s2">&quot;0 &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">i</span><span class="o">+</span><span class="mi">1</span><span class="p">))</span>

            <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_axis&quot;</span><span class="p">,</span> <span class="n">final_axis_list</span><span class="p">),</span> <span class="n">single_commands</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>


    <span class="k">def</span> <span class="nf">stop_move</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;This function stops the table movement immediately&#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">table_ready</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;abort_movement&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>

<div class="viewcode-block" id="switching_control"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control">[docs]</a><span class="k">class</span> <span class="nc">switching_control</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class handles all switching actions, for all switching devices</span>

<span class="sd">        :param settings: default settings ( state machine )</span>
<span class="sd">        :param devices: devices dict</span>
<span class="sd">        :param queue_to_main: The queue object to the main</span>
<span class="sd">        :param vcw: A visa connect wizard instance</span>
<span class="sd">        &quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">settings</span><span class="p">,</span> <span class="n">devices</span><span class="p">,</span> <span class="n">queue_to_main</span><span class="p">,</span> <span class="n">vcw</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This class handles all switching actions</span>

<span class="sd">        :param settings: default settings ( state machine )</span>
<span class="sd">        :param devices: devices dict</span>
<span class="sd">        :param queue_to_main: The queue object to the main</span>
<span class="sd">        :param vcw: A visa connect wizard instance</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span> <span class="o">=</span> <span class="n">settings</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">message_to_main</span> <span class="o">=</span> <span class="n">queue_to_main</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">devices</span> <span class="o">=</span> <span class="n">devices</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span> <span class="o">=</span> <span class="n">vcw</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">switching_systems</span> <span class="o">=</span> <span class="p">[]</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span> <span class="o">=</span> <span class="n">build_command</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;current_switching&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

        <span class="c1"># Find all switching relays and store them for easy access</span>
        <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="s2">&quot;Switching relay&quot;</span> <span class="ow">in</span> <span class="n">dev</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;Device_type&quot;</span><span class="p">,</span><span class="s2">&quot;None&quot;</span><span class="p">)</span> <span class="ow">and</span> <span class="s2">&quot;Visa_Resource&quot;</span> <span class="ow">in</span> <span class="n">dev</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;current_switching&quot;</span><span class="p">][</span><span class="n">dev</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="p">[]</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">switching_systems</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">dev</span><span class="p">)</span>

<div class="viewcode-block" id="switching_control.reset_switching"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.reset_switching">[docs]</a>    <span class="k">def</span> <span class="nf">reset_switching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="o">=</span><span class="s2">&quot;all&quot;</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function resets all switching or one device switching</span>

<span class="sd">        :param device: all oder device object:</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="k">if</span> <span class="n">device</span> <span class="o">==</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span> <span class="c1"># opens all switches in all relays</span>
            <span class="k">for</span> <span class="n">dev</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switching_systems</span><span class="p">:</span>
                <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="s2">&quot;set_open_channel_all&quot;</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">check_all_closed_channel</span><span class="p">(</span><span class="n">dev</span><span class="p">,</span> <span class="p">[])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;set_open_channel_all&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">check_all_closed_channel</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="p">[])</span></div>

<div class="viewcode-block" id="switching_control.check_switching_action"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.check_switching_action">[docs]</a>    <span class="k">def</span> <span class="nf">check_switching_action</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Checks what channels are closed on all switching devices&quot;&quot;&quot;</span>
        <span class="n">current_switching</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">devices</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">switching_systems</span><span class="p">:</span>
            <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="s2">&quot;get_closed_channels&quot;</span><span class="p">)</span>
            <span class="n">switching</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="n">switching</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pick_switch_response</span><span class="p">(</span><span class="n">devices</span><span class="p">,</span> <span class="n">switching</span><span class="p">)</span>
            <span class="n">current_switching</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">devices</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">]:</span> <span class="n">switching</span><span class="p">})</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;current_switching&quot;</span><span class="p">][</span><span class="n">devices</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">current_switching</span>
        <span class="k">return</span> <span class="n">current_switching</span></div>

<div class="viewcode-block" id="switching_control.apply_specific_switching"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.apply_specific_switching">[docs]</a>    <span class="k">def</span> <span class="nf">apply_specific_switching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">switching_dict</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        This function takes a dict of type {&quot;Switching&quot;: [/switch nodes], ....} and switches to these specific type</span>

<span class="sd">        :param switching_dict: What to switch</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">switching_dict</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
                <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_switching</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">device</span><span class="p">],</span> <span class="n">switching_dict</span><span class="p">[</span><span class="n">device</span><span class="p">]):</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Manual switching was not possible&quot;</span><span class="p">)</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="k">return</span> <span class="kc">True</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Could not find switching device: </span><span class="si">{}</span><span class="s2">. It may not be connected or specified.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">device</span><span class="p">))</span></div>
                <span class="c1">#return  False</span>

    <span class="c1">#@check_if_switching_possible</span>
<div class="viewcode-block" id="switching_control.switch_to_measurement"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.switch_to_measurement">[docs]</a>    <span class="k">def</span> <span class="nf">switch_to_measurement</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">measurement</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function switches all switching systems to a specific measurement type</span>

<span class="sd">        :param measurement: string e.g. &quot;IV&quot;, &quot;CV&quot; must be defined in the switching dict</span>
<span class="sd">        :return: true or false, so if switching was successfull or not</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">switching_systems</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;No switching systems defined but attempt to switch to measurement </span><span class="si">{}</span><span class="s2">. &quot;</span>
                              <span class="s2">&quot;Returning dummy True&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measurement</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">True</span>

        <span class="c1">#Todo: Brandbox is sended twice due to double occurance (humidity controller), but maybe its for the best, since the thing isnt working properly</span>
        <span class="c1">#First find measurement</span>
        <span class="n">switching_success</span> <span class="o">=</span> <span class="kc">False</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Switching to measurement: </span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">str</span><span class="p">(</span><span class="n">measurement</span><span class="p">)))</span>
        <span class="k">if</span> <span class="n">measurement</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Switching&quot;</span><span class="p">][</span><span class="s2">&quot;Switching_Schemes&quot;</span><span class="p">]:</span>
            <span class="c1"># When measurement was found</span>
            <span class="k">for</span> <span class="n">name</span><span class="p">,</span> <span class="n">switch_list</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;Switching&quot;</span><span class="p">][</span><span class="s2">&quot;Switching_Schemes&quot;</span><span class="p">][</span><span class="n">measurement</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                <span class="k">if</span> <span class="n">name</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">:</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="n">switch_list</span><span class="p">:</span>
                        <span class="n">switch_list</span> <span class="o">=</span> <span class="p">[]</span>
                    <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">change_switching</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="n">name</span><span class="p">],</span> <span class="n">switch_list</span><span class="p">):</span>
                        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Switching to </span><span class="si">{}</span><span class="s2"> was not possible&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">switch_list</span><span class="p">))</span>
                        <span class="k">return</span> <span class="kc">False</span>
                <span class="k">else</span><span class="p">:</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Switching device: </span><span class="si">{}</span><span class="s2"> was not found in active resources. No switching done!&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">name</span><span class="p">))</span>
                    <span class="k">return</span> <span class="kc">False</span>
            <span class="k">return</span> <span class="kc">True</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Measurement </span><span class="si">{}</span><span class="s2"> switching could not be found in defined switching schemes.&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">measurement</span><span class="p">))</span>
            <span class="k">return</span> <span class="kc">False</span></div>

    <span class="k">def</span> <span class="nf">__send_switching_command</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">order</span><span class="p">,</span> <span class="n">list_of_commands</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Sends a switching command&quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="n">list_of_commands</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">list_of_commands</span><span class="p">[</span><span class="mi">0</span><span class="p">]:</span>
                <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="p">(</span><span class="n">order</span><span class="p">,</span> <span class="n">list_of_commands</span><span class="p">))</span>
                <span class="k">if</span> <span class="n">command</span><span class="p">:</span> <span class="c1">#If something dont work with the building of the command, no None will be send</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span>  <span class="c1"># Write new switching</span>

<div class="viewcode-block" id="switching_control.pick_switch_response"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.pick_switch_response">[docs]</a>    <span class="k">def</span> <span class="nf">pick_switch_response</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">current_switching</span><span class="p">):</span>
        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        This function picks the string response and returns a list.</span>
<span class="sd">        This function searches for a separator in the device dict and uses it to discect the message, standard is &#39;,&#39;</span>

<span class="sd">        :device: The device object</span>
<span class="sd">        :param current_switching: is a string containing the current switching</span>
<span class="sd">        &#39;&#39;&#39;</span>

        <span class="k">if</span> <span class="n">current_switching</span> <span class="o">==</span> <span class="s2">&quot;nil&quot;</span><span class="p">:</span>
            <span class="k">return</span> <span class="p">[]</span>


        <span class="c1">#syntax_list = device.get(&quot;syntax&quot;, &quot;&quot;)</span>
        <span class="c1">#if syntax_list:</span>
        <span class="c1">#    syntax_list = syntax_list.split(&quot;###&quot;)# gets me header an footer from syntax</span>

        <span class="n">sep</span> <span class="o">=</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;separator&quot;</span><span class="p">,</span> <span class="s2">&quot;,&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="n">current_switching</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="n">sep</span><span class="p">)</span></div>


        <span class="c1"># Warning 7001 keithley sometimes seperates values by , and sometimes by : !!!!!!!!!</span>
        <span class="c1"># Sometimes it also happens that it mixes everything -&gt; this means that the channel from to are closed etc.</span>
        <span class="c1"># LEGACY CODE</span>
        <span class="c1"># if &quot;:&quot; in current_switching:</span>
        <span class="c1">#     self.log.error(&quot;The switching syntax for this is not yet implemented, discrepancies do occure from displayed to actually switched case. TODO&quot;)</span>
        <span class="c1">#     if &quot;,&quot; in current_switching: # if this shitty mix happens</span>
        <span class="c1">#         current_switching = current_switching.replace(&quot;,&quot;, &quot;:&quot;)</span>
        <span class="c1">#     if len(syntax_list) &gt; 1:</span>
        <span class="c1">#         current_switching = current_switching[len(syntax_list[0]): -len(syntax_list[1])]</span>
        <span class="c1">#         return current_switching.strip().split(&quot;:&quot;)  # now we have the right commands</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         return current_switching.strip().split(&quot;:&quot;)  # now we have the right commands</span>
        <span class="c1">#</span>
        <span class="c1"># if &quot;,&quot; in current_switching:</span>
        <span class="c1">#     if &quot;:&quot; in current_switching: # if this shitty mix happens</span>
        <span class="c1">#         current_switching = current_switching.replace(&quot;:&quot;, &quot;,&quot;)</span>
        <span class="c1">#     if len(syntax_list) &gt; 1:</span>
        <span class="c1">#         current_switching = current_switching[len(syntax_list[0]): -len(syntax_list[1])]</span>
        <span class="c1">#         #current_switching = current_switching.split(syntax_list[0]).split(syntax_list[1])</span>
        <span class="c1">#         return current_switching.strip().split(&quot;,&quot;)  # now we have the right commands</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         return current_switching.strip().split(&quot;,&quot;)  # now we have the right commands</span>
        <span class="c1">#</span>
        <span class="c1"># elif &quot;@&quot; in current_switching: # if no switching at all happens</span>
        <span class="c1">#     if len(syntax_list) &gt; 1:</span>
        <span class="c1">#         current_switching = current_switching[len(syntax_list[0]): -len(syntax_list[1])]</span>
        <span class="c1">#         return current_switching.strip().split()  # now we have the right commands</span>
        <span class="c1">#     else:</span>
        <span class="c1">#         return current_switching.strip().split()  # now we have the right commands</span>
        <span class="c1"># else:</span>
        <span class="c1">#     return current_switching.strip().split()  # now we have the right commands</span>

<div class="viewcode-block" id="switching_control.change_switching"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.change_switching">[docs]</a>    <span class="k">def</span> <span class="nf">change_switching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">config</span><span class="p">):</span> <span class="c1"># Has to be a string command or a list of commands containing strings!!</span>

        <span class="sd">&#39;&#39;&#39;</span>
<span class="sd">        Fancy name, but just sends the swithing command</span>

<span class="sd">        :device: The device object</span>
<span class="sd">        :param config: the list of nodes which need to be switched</span>
<span class="sd">        &#39;&#39;&#39;</span>
        <span class="c1"># Check if only a string is passed and not a list and convert into list if need be</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">config</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="p">[</span><span class="n">config</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">configs</span> <span class="o">=</span> <span class="n">config</span>

        <span class="k">if</span> <span class="s2">&quot;Visa_Resource&quot;</span> <span class="ow">in</span> <span class="n">device</span><span class="p">:</span> <span class="c1">#Searches for the visa resource</span>
            <span class="n">resource</span> <span class="o">=</span> <span class="n">device</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;The VISA resource for device &quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot; could not be found. No switching possible.&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="kc">False</span>

        <span class="k">if</span> <span class="n">device</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;device_exclusive_switching&quot;</span><span class="p">,</span> <span class="kc">False</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;Device exclusive switching used...&quot;</span><span class="p">)</span>
            <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">device_exclusive_switching</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span>
        <span class="k">else</span><span class="p">:</span>
             <span class="c1">#Normal switching</span>
             <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">manual_switching</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">,</span> <span class="n">BBM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">)</span></div>

<div class="viewcode-block" id="switching_control.device_exclusive_switching"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.device_exclusive_switching">[docs]</a>    <span class="k">def</span> <span class="nf">device_exclusive_switching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Switching will be done exclusivly by the device itself. Warning make sure the device is correctly configured if</span>
<span class="sd">        you are using this routine</span>

<span class="sd">        :param device:  The device</span>
<span class="sd">        :param configs:  The configs dict</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__send_switching_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;set_exclusive_close_channel&quot;</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span>
        <span class="c1"># Check if switching is done</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_all_closed_channel</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span></div>


<div class="viewcode-block" id="switching_control.manual_switching"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.manual_switching">[docs]</a>    <span class="k">def</span> <span class="nf">manual_switching</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">,</span> <span class="n">BBM</span> <span class="o">=</span> <span class="kc">True</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Manual switching, so opening and closing of channels is done via this software. Old keithley will need this</span>
<span class="sd">        Newer devices can do exclusive opening and closing.</span>
<span class="sd">        BBM or Break-before-make is the order how to switch, if False make-before-break is used. This is not</span>
<span class="sd">        recommended since it can dry weld the switches.</span>

<span class="sd">        :param device:  The device</span>
<span class="sd">        :param configs:  The configs dict</span>
<span class="sd">        :param BBM: Break before make or make before break,</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;get_closed_channels&quot;</span><span class="p">)</span>
        <span class="n">current_switching</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">command</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>  <span class="c1"># Get current switching</span>
        <span class="n">current_switching</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pick_switch_response</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">current_switching</span><span class="p">)</span>

        <span class="n">to_open_channels</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_switching</span><span class="p">)</span> <span class="o">-</span> <span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">configs</span><span class="p">)))</span>  <span class="c1"># all channels which need to be closed</span>
        <span class="n">to_close_channels</span> <span class="o">=</span> <span class="n">configs</span>

        <span class="k">if</span> <span class="n">BBM</span><span class="p">:</span>
            <span class="n">comm</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;set_open_channel&quot;</span><span class="p">,</span> <span class="s2">&quot;set_close_channel&quot;</span><span class="p">]</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_open_channels</span><span class="p">,</span> <span class="n">to_close_channels</span><span class="p">]</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="n">comm</span> <span class="o">=</span> <span class="p">[</span><span class="s2">&quot;set_close_channel&quot;</span><span class="p">,</span> <span class="s2">&quot;set_open_channel&quot;</span><span class="p">]</span>
            <span class="n">channels</span> <span class="o">=</span> <span class="p">[</span><span class="n">to_close_channels</span><span class="p">,</span> <span class="n">to_open_channels</span><span class="p">]</span>

        <span class="c1"># Close channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__send_switching_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">comm</span><span class="p">[</span><span class="mi">0</span><span class="p">],</span> <span class="n">channels</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>

        <span class="c1"># Open channels</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">__send_switching_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">comm</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">channels</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>

        <span class="c1"># Check if switching is done (basically the same proceedure like before only in the end there is a check</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_all_closed_channel</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">configs</span><span class="p">)</span></div>

<div class="viewcode-block" id="switching_control.check_all_closed_channel"><a class="viewcode-back" href="../../Tools.html#COMET.utilities.switching_control.check_all_closed_channel">[docs]</a>    <span class="k">def</span> <span class="nf">check_all_closed_channel</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">device</span><span class="p">,</span> <span class="n">to_be</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        Checks if all channels are correctly closed</span>

<span class="sd">        :param device: The device</span>
<span class="sd">        :param to_be: the to be state of the relays for this device</span>
<span class="sd">        :return: bool</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="n">device_not_ready</span> <span class="o">=</span> <span class="kc">True</span>
        <span class="n">counter</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="n">opc_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;get_operation_complete&quot;</span><span class="p">)</span>
        <span class="n">opc_success</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;get_operation_complete&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;success&quot;</span><span class="p">,</span> <span class="s2">&quot;1&quot;</span><span class="p">))</span>
        <span class="n">all_closed_command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="s2">&quot;get_closed_channels&quot;</span><span class="p">)</span>

        <span class="k">while</span> <span class="n">device_not_ready</span><span class="p">:</span>
            <span class="n">all_done</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">opc_command</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
            <span class="k">if</span> <span class="n">all_done</span> <span class="o">==</span> <span class="n">opc_success</span><span class="p">:</span>
                <span class="n">current_switching</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">all_closed_command</span><span class="p">))</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
                <span class="n">current_switching</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">pick_switch_response</span><span class="p">(</span><span class="n">device</span><span class="p">,</span> <span class="n">current_switching</span><span class="p">)</span>
                <span class="bp">self</span><span class="o">.</span><span class="n">settings</span><span class="p">[</span><span class="s2">&quot;settings&quot;</span><span class="p">][</span><span class="s2">&quot;current_switching&quot;</span><span class="p">][</span><span class="n">device</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">]]</span> <span class="o">=</span> <span class="n">current_switching</span>
                <span class="n">command_diff</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">to_be</span><span class="p">)</span><span class="o">.</span><span class="n">difference</span><span class="p">(</span><span class="nb">set</span><span class="p">(</span><span class="n">current_switching</span><span class="p">)))</span>
                <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">command_diff</span><span class="p">)</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>  <span class="c1">#Checks if all the right channels are closed</span>
                    <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;Switching to </span><span class="si">{}</span><span class="s2">  was not possible. Difference read:</span><span class="si">{}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">to_be</span><span class="p">,</span> <span class="n">current_switching</span><span class="p">))</span>
                    <span class="k">return</span> <span class="kc">False</span>
                <span class="k">return</span> <span class="kc">True</span>
            <span class="k">if</span> <span class="n">counter</span> <span class="o">&gt;</span> <span class="mi">5</span><span class="p">:</span>
                <span class="n">device_not_ready</span> <span class="o">=</span> <span class="kc">False</span>
            <span class="n">counter</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;No response from switching system: &quot;</span> <span class="o">+</span> <span class="n">device</span><span class="p">[</span><span class="s2">&quot;Device_name&quot;</span><span class="p">])</span>
        <span class="k">return</span> <span class="kc">False</span></div></div>

<span class="k">def</span> <span class="nf">load_QtCSS_StyleSheet</span><span class="p">(</span><span class="n">path</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Loads the QtCSS style sheet&quot;&quot;&quot;</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">path</span><span class="p">,</span> <span class="s1">&#39;rt&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">f</span><span class="p">:</span>
        <span class="n">lines</span> <span class="o">=</span> <span class="n">f</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">lines</span>

<span class="k">class</span> <span class="nc">show_cursor_position</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This class provides a simple way to tooltip a plot item of type pyqtgraph plots (not yet finished)&quot;&quot;&quot;</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">plotobject</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;</span>

<span class="sd">        :param plotobject: The Plot object</span>
<span class="sd">        &quot;&quot;&quot;</span>

        <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span> <span class="o">=</span> <span class="n">plotobject</span><span class="o">.</span><span class="n">getPlotItem</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">TextItem</span><span class="p">(</span><span class="n">text</span><span class="o">=</span><span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">color</span><span class="o">=</span><span class="p">(</span><span class="mi">176</span><span class="p">,</span> <span class="mi">23</span><span class="p">,</span> <span class="mi">31</span><span class="p">))</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>
        <span class="n">plotobject</span><span class="o">.</span><span class="n">addItem</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span><span class="p">,</span> <span class="n">ignoreBounds</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">proxy</span> <span class="o">=</span> <span class="n">pg</span><span class="o">.</span><span class="n">SignalProxy</span><span class="p">(</span><span class="n">plotobject</span><span class="o">.</span><span class="n">scene</span><span class="p">()</span><span class="o">.</span><span class="n">sigMouseMoved</span><span class="p">,</span> <span class="n">rateLimit</span><span class="o">=</span><span class="mi">30</span><span class="p">,</span> <span class="n">slot</span><span class="o">=</span><span class="bp">self</span><span class="o">.</span><span class="n">onMove</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">onMove</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">pos</span><span class="p">):</span>
        <span class="n">mousePoint</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">plotItem</span><span class="o">.</span><span class="n">vb</span><span class="o">.</span><span class="n">mapSceneToView</span><span class="p">(</span><span class="n">pos</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
        <span class="c1">#self.plotItem.mapToDevice(mousePoint)</span>
        <span class="k">if</span> <span class="n">mousePoint</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span><span class="o">.</span><span class="n">setText</span><span class="p">(</span><span class="s2">&quot;     x=</span><span class="si">{!s}</span><span class="se">\n</span><span class="s2">     y=</span><span class="si">{!s}</span><span class="s2">&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="nb">int</span><span class="p">(</span><span class="nb">round</span><span class="p">(</span><span class="n">mousePoint</span><span class="o">.</span><span class="n">x</span><span class="p">(),</span><span class="mi">0</span><span class="p">)),</span> <span class="n">EngUnit</span><span class="p">(</span><span class="n">mousePoint</span><span class="o">.</span><span class="n">y</span><span class="p">())))</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span><span class="o">.</span><span class="n">setPos</span><span class="p">(</span><span class="n">mousePoint</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span><span class="o">.</span><span class="n">show</span><span class="p">()</span>

        <span class="k">else</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">tooltip_text</span><span class="o">.</span><span class="n">hide</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">reset_devices</span><span class="p">(</span><span class="n">devices_dict</span><span class="p">,</span> <span class="n">vcw</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Reset all devices.&quot;&quot;&quot;</span>
    <span class="n">l</span><span class="o">.</span><span class="n">critical</span><span class="p">(</span><span class="s2">&quot;You are using a depricated reset devices function please remove it from your code&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">device</span> <span class="ow">in</span> <span class="n">devices_dict</span><span class="p">:</span>
        <span class="c1"># Looks if a Visa resource is assigned to the device.</span>
        <span class="k">if</span> <span class="s2">&quot;Visa_Resource&quot;</span> <span class="ow">in</span> <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">]:</span>

            <span class="c1"># Initiate the instrument and resets it</span>
            <span class="k">if</span> <span class="s2">&quot;reset_device&quot;</span> <span class="ow">in</span> <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">]:</span>
                <span class="n">vcw</span><span class="o">.</span><span class="n">initiate_instrument</span><span class="p">(</span>
                    <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s2">&quot;Visa_Resource&quot;</span><span class="p">],</span>
                    <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s2">&quot;reset_device&quot;</span><span class="p">],</span>
                    <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_terminator&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="p">)</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">vcw</span><span class="o">.</span><span class="n">initiate_instrument</span><span class="p">(</span>
                    <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">][</span><span class="s2">&quot;Visa_Resource&quot;</span><span class="p">],</span>
                    <span class="p">[</span><span class="s2">&quot;*rst&quot;</span><span class="p">,</span> <span class="s2">&quot;*cls&quot;</span><span class="p">,</span> <span class="s2">&quot;TRAC:CLE&quot;</span><span class="p">],</span>
                    <span class="n">devices_dict</span><span class="p">[</span><span class="n">device</span><span class="p">]</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;execution_terminator&quot;</span><span class="p">,</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
                <span class="p">)</span>

<span class="k">class</span> <span class="nc">KeyPress</span><span class="p">():</span>
    <span class="c1">#keyPressed = QtCore.pyqtSignal(QtCore.QEvent)</span>

    <span class="k">def</span> <span class="nf">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">app</span><span class="p">,</span> <span class="n">to_call</span><span class="p">,</span> <span class="n">keys_objects</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Define which key should be possible to press and what to do with it</span>
<span class="sd">        QtCore.Qt.Key_Enter</span>
<span class="sd">        QtCore.Qt.Key_Q etc.&quot;&quot;&quot;</span>
        <span class="c1">#super(KeyPress, self).__init__()</span>
        <span class="c1">#self.keyPressed.connect(self.on_key)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">keys</span> <span class="o">=</span> <span class="n">keys_objects</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">call</span> <span class="o">=</span> <span class="n">to_call</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span> <span class="o">=</span> <span class="n">app</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">app</span><span class="o">.</span><span class="n">installEventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">eventFilter</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="nb">object</span><span class="p">,</span> <span class="n">event</span><span class="p">):</span>
        <span class="k">if</span> <span class="n">event</span><span class="o">.</span><span class="n">key</span><span class="p">()</span> <span class="ow">in</span> <span class="bp">self</span><span class="o">.</span><span class="n">keys</span><span class="p">:</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">call</span><span class="p">(</span><span class="n">event</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">parse_args</span><span class="p">():</span>

    <span class="kn">import</span> <span class="nn">argparse</span>
    <span class="n">parser</span> <span class="o">=</span> <span class="n">argparse</span><span class="o">.</span><span class="n">ArgumentParser</span><span class="p">()</span>
    <span class="n">parser</span><span class="o">.</span><span class="n">add_argument</span><span class="p">(</span><span class="s2">&quot;--reinit&quot;</span><span class="p">,</span> <span class="n">help</span><span class="o">=</span><span class="s2">&quot;Calls the init window to initialize the setups&quot;</span><span class="p">,</span>
                        <span class="n">action</span><span class="o">=</span><span class="s2">&quot;store_true&quot;</span><span class="p">)</span>

    <span class="n">args</span> <span class="o">=</span> <span class="n">parser</span><span class="o">.</span><span class="n">parse_args</span><span class="p">()</span>

    <span class="k">return</span> <span class="n">args</span>

<span class="k">def</span> <span class="nf">convert_to_df</span><span class="p">(</span><span class="n">to_convert</span><span class="p">,</span> <span class="nb">abs</span> <span class="o">=</span> <span class="kc">False</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    Converts a dict to panda dataframes for easy manipulation etc.</span>
<span class="sd">    :param data: Dictionary with data</span>
<span class="sd">    :param abs: if the data returned will be the absolute value of the data</span>
<span class="sd">    :return: pandas data frame object</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="c1"># Convert all data to panda data frames</span>
    <span class="n">index</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_convert</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">columns</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">to_convert</span><span class="p">[</span><span class="n">index</span><span class="p">[</span><span class="mi">0</span><span class="p">]][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())</span>
    <span class="n">return_dict</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;All&quot;</span><span class="p">:</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">columns</span><span class="o">=</span><span class="n">columns</span><span class="p">),</span> <span class="s2">&quot;keys&quot;</span><span class="p">:</span> <span class="n">index</span><span class="p">,</span> <span class="s2">&quot;columns&quot;</span><span class="p">:</span><span class="n">columns</span><span class="p">}</span>
    <span class="k">for</span> <span class="n">key</span><span class="p">,</span> <span class="n">data</span> <span class="ow">in</span> <span class="n">to_convert</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">data</span>
        <span class="k">try</span><span class="p">:</span>
            <span class="k">if</span> <span class="nb">abs</span><span class="p">:</span>
                <span class="k">for</span> <span class="n">meas</span><span class="p">,</span> <span class="n">arr</span> <span class="ow">in</span> <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">items</span><span class="p">():</span>
                    <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="n">meas</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span><span class="p">)</span>
            <span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="s2">&quot;Name&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="p">[</span><span class="n">key</span> <span class="k">for</span> <span class="n">i</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">][</span><span class="nb">list</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="mi">0</span><span class="p">]]))]</span>
            <span class="n">df</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">DataFrame</span><span class="p">(</span><span class="n">data</span><span class="o">=</span><span class="n">data</span><span class="p">[</span><span class="s2">&quot;data&quot;</span><span class="p">])</span>
        <span class="k">except</span> <span class="ne">KeyError</span> <span class="k">as</span> <span class="n">err</span><span class="p">:</span>
            <span class="n">l</span><span class="o">.</span><span class="n">error</span><span class="p">(</span><span class="s2">&quot;In order to convert the data to panda dataframe, the data structure needs to have a key:&#39;data&#39;&quot;</span><span class="p">)</span>
            <span class="k">raise</span> <span class="n">err</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">df</span>
        <span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">pd</span><span class="o">.</span><span class="n">concat</span><span class="p">([</span><span class="n">return_dict</span><span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">],</span><span class="n">df</span><span class="p">],</span> <span class="n">sort</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span>

    <span class="k">return</span> <span class="n">return_dict</span>


<span class="k">class</span> <span class="nc">NumpyEncoder</span><span class="p">(</span><span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="p">):</span>
    <span class="k">def</span> <span class="nf">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">):</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">obj</span><span class="p">,</span> <span class="n">np</span><span class="o">.</span><span class="n">ndarray</span><span class="p">):</span>
           <span class="k">return</span> <span class="n">obj</span><span class="o">.</span><span class="n">tolist</span><span class="p">()</span>
        <span class="k">return</span> <span class="n">json</span><span class="o">.</span><span class="n">JSONEncoder</span><span class="o">.</span><span class="n">default</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">obj</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_dict_as_json</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dirr</span><span class="p">,</span> <span class="n">base_name</span><span class="p">):</span>
    <span class="n">json_dump</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
    <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirr</span><span class="p">,</span> <span class="n">base_name</span><span class="o">+</span><span class="s2">&quot;.json&quot;</span><span class="p">),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
        <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_dump</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">data</span><span class="p">:</span>
        <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirr</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.json&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)),</span> <span class="s1">&#39;w&#39;</span><span class="p">)</span> <span class="k">as</span> <span class="n">outfile</span><span class="p">:</span>
            <span class="n">json_dump</span> <span class="o">=</span> <span class="n">json</span><span class="o">.</span><span class="n">dumps</span><span class="p">(</span><span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">],</span> <span class="bp">cls</span><span class="o">=</span><span class="n">NumpyEncoder</span><span class="p">)</span>
            <span class="n">json</span><span class="o">.</span><span class="n">dump</span><span class="p">(</span><span class="n">json_dump</span><span class="p">,</span> <span class="n">outfile</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">save_dict_as_hdf5</span><span class="p">(</span><span class="n">data</span><span class="p">,</span> <span class="n">dirr</span><span class="p">,</span> <span class="n">base_name</span><span class="p">):</span>
    <span class="n">df</span> <span class="o">=</span> <span class="n">convert_to_df</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
    <span class="n">df</span><span class="p">[</span><span class="s2">&quot;All&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirr</span><span class="p">,</span> <span class="n">base_name</span><span class="o">+</span><span class="s2">&quot;.hdf5&quot;</span><span class="p">),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">key</span> <span class="ow">in</span> <span class="n">df</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="s2">&quot;keys&quot;</span><span class="p">,</span> <span class="p">[]):</span>
        <span class="n">data</span><span class="p">[</span><span class="n">key</span><span class="p">][</span><span class="s2">&quot;data&quot;</span><span class="p">]</span><span class="o">.</span><span class="n">to_hdf</span><span class="p">(</span><span class="n">os</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">dirr</span><span class="p">,</span> <span class="s2">&quot;</span><span class="si">{}</span><span class="s2">.hdf5&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">key</span><span class="p">)),</span> <span class="n">key</span><span class="o">=</span><span class="s1">&#39;df&#39;</span><span class="p">,</span> <span class="n">mode</span><span class="o">=</span><span class="s1">&#39;w&#39;</span><span class="p">)</span>



<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span>

    <span class="k">pass</span>
</pre></div>

           </div>
           
          </div>
          <footer>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dominic Bloech

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>