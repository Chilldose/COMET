

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="Python 3.7" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="Python 3.7" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>How to &mdash; COMET beta documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script src="_static/jquery.js"></script>
        <script src="_static/underscore.js"></script>
        <script src="_static/doctools.js"></script>
        <script src="_static/language_data.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Measurement Job Generation" href="measurementjobgen.html" />
    <link rel="prev" title="Getting Started" href="gettingstarted.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> COMET
          

          
          </a>

          
            
            
              <div class="version">
                0.10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">COMET Guides</span></p>
<ul class="current">
<li class="toctree-l1"><a class="reference internal" href="programstructure.html">COMET layout</a></li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1 current"><a class="current reference internal" href="#">How to</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#switch-to-another-gui">Switch to another GUI</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-gui-element">Add a GUI element</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-new-device">Add a new device</a></li>
<li class="toctree-l2"><a class="reference internal" href="#create-a-new-device">Create a new device</a><ul>
<li class="toctree-l3"><a class="reference internal" href="#device-command-structure">Device Command Structure</a></li>
</ul>
</li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-new-measurement">Add a new measurement</a></li>
<li class="toctree-l2"><a class="reference internal" href="#add-a-continuous-environment-monitor">Add a continuous environment monitor</a></li>
<li class="toctree-l2"><a class="reference internal" href="#change-the-behaviour-of-the-framework-and-misc">Change the behaviour of the framework and misc.</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="measurementjobgen.html">Measurement Job Generation</a></li>
</ul>
<p class="caption"><span class="caption-text">COMET Structure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="datastructure.html">Data Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataexchange.html">Data Exchange</a></li>
</ul>
<p class="caption"><span class="caption-text">Measurement Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="measurement_plugins/IVCV.html">IVCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_plugins/Stripscan.html">Stripscan</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_plugins/RelaxTimeAnalysis.html">Relaxation Time Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">General Purpose Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/resources.html">Resources Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Device_Com.html">Device Communication Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Data_Explorer.html">Data Explorer</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Data_Visualization.html">Data Visualization and Analysis</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Documentation.html">Documentation</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Switching_Control.html">Switching Matrix Control</a></li>
</ul>
<p class="caption"><span class="caption-text">Code references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">Measurement Tool Box functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html#vcw-visa-connect-wizard">VCW - Visa Connect Wizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html#xyz-stage-control-class">XYZ-Stage Control Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html#switching-system-control-class">Switching System Control Class</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">COMET</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>How to</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/tutorial.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="how-to">
<h1>How to<a class="headerlink" href="#how-to" title="Permalink to this headline">¶</a></h1>
<p>These tutorials will guide you through the process of generating your own own customized GUI and measurement routines.
Furthermore, it will guide you through the process to create and add new physical measurement devices.</p>
<p>Before we can start, please follow the steps in chapter <a class="reference internal" href="gettingstarted.html#your-first-gui"><span class="std std-ref">Your first GUI</span></a> and create an empty new Project with the name of your liking.</p>
<div class="section" id="switch-to-another-gui">
<h2>Switch to another GUI<a class="headerlink" href="#switch-to-another-gui" title="Permalink to this headline">¶</a></h2>
<p>The first time you start up COMET you will be asked what GUI you want to load see <a class="reference internal" href="gettingstarted.html#running-initializing-the-program"><span class="std std-ref">Running/Initializing The Program</span></a>. If you decide to load another GUI
after your first start up you can change you preferences via the &quot;Edit/Prefernece&quot; option in the header of the GUI. Or if you want to
load a specific GUI at start up you can pass the option <code class="docutils literal notranslate"><span class="pre">--loadGUI</span> <span class="pre">&lt;your_GUI_name&gt;</span></code> or if you do not know for sure what GUI you want
and you want to be prompted with all GUIs available type <code class="docutils literal notranslate"><span class="pre">--reinit</span></code> and COMET will start up like the first time you started it.</p>
</div>
<div class="section" id="add-a-gui-element">
<h2>Add a GUI element<a class="headerlink" href="#add-a-gui-element" title="Permalink to this headline">¶</a></h2>
<p>Your program has - most likely - no productive GUI elements at all, if its want you wanted: <em>Awesome</em>. If not, we ought to change that.
In order to do so we need to design a GUI first.</p>
<p>COMET can work with <strong>QTDesigner</strong> <code class="docutils literal notranslate"><span class="pre">.ui</span></code> files.
With the <a class="reference internal" href="installation.html#installation"><span class="std std-ref">Installation</span></a> of this software, which you have followed I hope, the so-called QtDesigner was installed as well.
If features a simple GUI based program, in which you can generate your own GUI and save them in <code class="docutils literal notranslate"><span class="pre">.ui</span></code> format.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>You can normally find the QTDesigner in your install directory of python under the QT directory in the lib. And I will not go into details on how you build GUIs in QtDesigner, there are plenty of tutorial videos in the web.</p>
</div>
<p>When your GUI element is finished save it in the directory <code class="docutils literal notranslate"><span class="pre">.COMET/QT_Designer_UI</span></code>. Now COMET can access them easily.</p>
<p>The next step is to tell the Program to render this UI. Open the <code class="docutils literal notranslate"><span class="pre">settings.yml</span></code> in your project folder and
add in the parameter <code class="docutils literal notranslate"><span class="pre">GUI_render_order</span></code> with a list value of <code class="docutils literal notranslate"><span class="pre">&lt;YourCoolGUI&gt;</span></code>.</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">GUI_render_order</span><span class="p">:</span>
    <span class="o">-</span> <span class="n">YourCoolGUI</span>
    <span class="o">-</span> <span class="n">DeviceCommunication</span>
    <span class="o">-</span> <span class="n">Resources</span>
    <span class="o">-</span> <span class="n">DataBrowser</span>
</pre></div>
</div>
<p>Unfortunately this is not all. We know have to write some code to tell the framework that we want to render this <code class="docutils literal notranslate"><span class="pre">.ui</span></code> file you have just created.
For this we generate a file in the directory <code class="docutils literal notranslate"><span class="pre">.COMET/ui_plugins</span></code>. This file you have to call <code class="docutils literal notranslate"><span class="pre">&lt;YourCoolGUI&gt;_window.py</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>It is important, that you add the suffix <code class="docutils literal notranslate"><span class="pre">_window</span></code> to your python file, this makes it clear for the framework, that this is a window and treads it as one. All other files will be ignored and cannot be added this way!</p>
</div>
<p>Inside your python GUI plugin you have to direct the framework what to do.
The minimal example to run just the GUI without anything else is as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span>from PyQt5 import QtGui
from PyQt5.QtGui import *
from PyQt5.QtWidgets import *
import logging

class &lt;YourCoolGUI&gt;_window:
    def __init__(self, GUI_classes, layout):
        self.variables = GUI_classes    # Containing all variables and methods from the parent class for example the state machine
        self.layout = layout            # The layout class in which will be rendered
        self.log = logging.getLogger(__name__) # This is optional, but you do want to write to the logger

        # Loading the UI plugin
        &lt;YourCoolGUI&gt;_widget = QWidget()
        self.&lt;YourCoolGUI&gt; = self.variables.load_QtUi_file(&quot;./COMET/QT_Designer_UI/&lt;YourCoolGUI&gt;&quot;, &lt;YourCoolGUI&gt;_widget)
        self.layout.addWidget(&lt;YourCoolGUI&gt;_widget)
</pre></div>
</div>
<p>After that it renders the GUI when you restart COMET. But this code does not have and logic to it. You can add python
member functions to it. To access the ui classes from your GUI e.g. buttons and so on, you have to do it via <code class="docutils literal notranslate"><span class="pre">self.&lt;YourCoolGUI&gt;.foo()</span></code> etc.</p>
<p>If you restart COMET you should see a window tab called &quot;&lt;YourCoolGUI&gt;&quot;. Wow, what an achievement!
Now that we know how to add some GUI elements to our program we can proceed and add some devices too.</p>
</div>
<div class="section" id="add-a-new-device">
<h2>Add a new device<a class="headerlink" href="#add-a-new-device" title="Permalink to this headline">¶</a></h2>
<p>Before we start with this tutorial make sure you have added the &quot;Resource&quot; tab to your GUI as described in the previous chapter or in the chatper <a class="reference internal" href="gettingstarted.html#your-first-gui"><span class="std std-ref">Your first GUI</span></a>.
This will make it easy to see if a new device was added or not.</p>
<p>Now that we have a GUI which can display all devices in the framework, we should add a device and see what happens.
To do so add the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">Devices</span><span class="p">:</span> <span class="c1"># Name of the config entry</span>
  <span class="o">&lt;</span><span class="n">Device_descriptor</span><span class="o">&gt;</span><span class="p">:</span> <span class="c1"># Some descriptor for the device</span>
    <span class="n">Device_name</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">A</span> <span class="n">Device</span> <span class="n">name</span><span class="o">&gt;</span>  <span class="c1"># Name of the device, this must be the same name as of one in the device library                                                                # The actual device name from which it should get all commands</span>
    <span class="n">Device_IDN</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">IDN</span> <span class="n">of</span> <span class="n">your</span> <span class="n">specific</span> <span class="n">device</span><span class="o">&gt;</span>
    <span class="n">Connection_resource</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">Connection</span> <span class="nb">type</span><span class="o">&gt;</span>
</pre></div>
</div>
<p>The top entry <strong>Devices</strong> is a mandatory entry which tells the software that the following entries are devices.
The sub-entries are up to your liking, but this will be the name of the internal representation of the device object in the software!</p>
<dl class="simple">
<dt>The entires:</dt><dd><ul class="simple">
<li><p>Device_name</p></li>
<li><p>Device_IDN</p></li>
<li><p>Connection_resource</p></li>
</ul>
</dd>
</dl>
<p>are mandatory for eacht sub-entries. You can extend this list as you like, the main framework will ignore them, but if you do need some additional parameters which cannot
be configured in the main device config, knock yourself out.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have a RS232 device connected you can add the <code class="docutils literal notranslate"><span class="pre">Baud_rate</span></code> parameter and change the default baud rate for the device. This also holds true for other RS232 parameters. For more information see, the device connection API reference for more information.</p>
</div>
<p><strong>Connection_resource</strong> is a parameter which tells the framework what kind of connection the device listens to and at what port.
Possible options are:</p>
<blockquote>
<div><ul class="simple">
<li><p>RS232:&lt;ComPort&gt;</p></li>
<li><p>GPIB:&lt;Address&gt;</p></li>
<li><p>IP:&lt;IP_INSTR_descriptor&gt;</p></li>
</ul>
</div></blockquote>
<p>If you then start the COMET software with your project selected. The device should appear in the resources tab. Depending if
the device is connected to the PC the connection lamp should switch to green, which means that the software has successfully established
a connection to the device and everything was configured correctly.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Most often, if you experience connection difficulties the Device_IDN is not completely correct entered.</p>
</div>
<p>The result schould lool like this:</p>
<img alt="Flowchart_main" class="floatingflask" src="_images/Resources1.png" />
<p>COMET furthermore knows the concept of alias names for devices.
This enables you to have an easy way to relabel devices and assign devices to more than one task. Imagine you have a device which
does some switching and can monitor the environment as well. Either you load the device twice with a different name and so on. Or you
assign an alias e.g. 1) &quot;HV Switching&quot; and 2) &quot;Humidity Monitor&quot; to the device. For the user it then looks like two devices but internally its the same device.
This prevents async. read and write operations to the device and makes it more robust.</p>
<p>To tell COMET to assign a alias to on device have a look at a specific example:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="c1"># Devices aliases for internal use, the key will then be the frameworks internal representation and the value is the display name</span>
 <span class="n">Aliases</span><span class="p">:</span>
     <span class="n">temphum_controller</span><span class="p">:</span> <span class="n">BrandBox</span>
     <span class="n">HVSwitching</span><span class="p">:</span> <span class="n">BrandBox</span>
     <span class="n">BiasSMU</span><span class="p">:</span> <span class="mi">2470</span> <span class="n">Keithley</span> <span class="n">SMU</span>
     <span class="n">lights_controller</span><span class="p">:</span> <span class="n">BrandBox</span>

 <span class="n">Devices</span><span class="p">:</span>
     <span class="mi">2470</span><span class="n">SMU</span><span class="p">:</span>
         <span class="n">Device_name</span><span class="p">:</span> <span class="mi">2470</span> <span class="n">Keithley</span> <span class="n">SMU</span>
         <span class="n">Device_IDN</span><span class="p">:</span> <span class="n">KEITHLEY</span> <span class="n">INSTRUMENTS</span><span class="p">,</span><span class="n">MODEL</span> <span class="mi">2470</span><span class="p">,</span><span class="mi">04424944</span><span class="p">,</span><span class="mf">1.6</span><span class="o">.</span><span class="mi">8</span><span class="n">d</span>
         <span class="n">Connection_resource</span><span class="p">:</span> <span class="n">IP</span><span class="p">:</span><span class="n">TCPIP0</span><span class="p">::</span><span class="mf">192.168</span><span class="o">.</span><span class="mf">130.131</span><span class="p">::</span><span class="n">inst0</span><span class="p">::</span><span class="n">INSTR</span>

     <span class="n">BrandBox</span><span class="p">:</span>
         <span class="n">Device_name</span><span class="p">:</span> <span class="n">BrandBox</span>
         <span class="n">Connection_resource</span><span class="p">:</span> <span class="n">RS232</span><span class="p">:</span><span class="mi">15</span>
         <span class="n">Device_IDN</span><span class="p">:</span> <span class="n">HV</span><span class="o">-</span><span class="n">Relay</span> <span class="n">Controller</span> <span class="n">V1</span><span class="o">.</span><span class="mi">6</span><span class="o">/</span><span class="mf">18.</span><span class="n">Apr</span><span class="o">.</span><span class="mi">2019</span>
</pre></div>
</div>
<p>In this case the device &quot;2470 Keithley SMU&quot; will be renamed to &quot;BiasSMU&quot; and the device &quot;BrandBox&quot; will become the devices
&quot;temphum_controller&quot;, &quot;HVSwitching&quot;, and &quot;lights_controller&quot;. Which internally, e.g. in your measurement plugin can directly be addressed with these names.</p>
</div>
<div class="section" id="create-a-new-device">
<h2>Create a new device<a class="headerlink" href="#create-a-new-device" title="Permalink to this headline">¶</a></h2>
<p>COMET ships with a large variety of different devices which have been preconfigured for easy use.
If you have a device which is not listed you have to add this device to the lib. To do so look in the directory, <code class="docutils literal notranslate"><span class="pre">configs\device_lib</span></code>.
There you can add your device as as <code class="docutils literal notranslate"><span class="pre">.yml</span></code> styled file. You can choose the name of the file as you see fit. As long it does not
interfere with another name in the same directory.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The software only accepts <code class="docutils literal notranslate"><span class="pre">.yml</span></code> files, all other files will be ignored.</p>
</div>
<p>Inside such a device file you can set a multitude of parameters. Such a exemplary device file looks as follows:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">Device_name</span><span class="p">:</span> <span class="mi">2470</span> <span class="n">Keithley</span> <span class="n">SMU</span>   <span class="c1"># Device name, the name you have to state in the settings file</span>
<span class="n">Display_name</span><span class="p">:</span> <span class="n">BiasSMU</span> <span class="c1"># Some easy to read name for the user</span>
<span class="n">Device_type</span><span class="p">:</span> <span class="n">SMU</span> <span class="c1"># Some descriptor what kind of device it is</span>

<span class="c1"># All set parameters</span>
<span class="n">set_beep</span><span class="p">:</span> <span class="n">beeper</span><span class="o">.</span><span class="n">beep</span><span class="p">({},</span> <span class="p">{})</span>
<span class="n">set_delay</span><span class="p">:</span> <span class="n">delay</span><span class="p">({})</span> <span class="c1"># Sets a delay to to following command!</span>
<span class="n">set_meas_delay</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">userdelay</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="p">{}</span>
<span class="n">set_measurement_function</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">func</span> <span class="o">=</span> <span class="p">{}</span> <span class="c1">#  smu.FUNC_DC_VOLTAGE/smu.FUNC_DC_CURRENT/smu.FUNC_RESISTANCE</span>
<span class="n">set_autorange_current</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">autorange</span> <span class="o">=</span> <span class="p">{}</span>

<span class="c1"># All get parameters</span>
<span class="n">get_read</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="n">smu</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">get_read_current</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="n">smu</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>
<span class="n">get_current_read</span><span class="p">:</span>  <span class="nb">print</span><span class="p">(</span><span class="n">smu</span><span class="o">.</span><span class="n">measure</span><span class="o">.</span><span class="n">read</span><span class="p">())</span>

<span class="c1"># All reset device parameters</span>
<span class="n">reset</span><span class="p">:</span>
   <span class="o">-</span> <span class="n">measurement_function</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">FUNC_DC_CURRENT</span>
   <span class="o">-</span> <span class="n">current_compliance</span><span class="p">:</span> <span class="mf">2e-6</span>
   <span class="o">-</span> <span class="n">autorange</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">ON</span>
   <span class="o">-</span> <span class="n">autozero</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">ON</span>
   <span class="o">-</span> <span class="n">measurement_count</span><span class="p">:</span> <span class="mi">1</span>
   <span class="o">-</span> <span class="n">filter_enable</span><span class="p">:</span> <span class="n">smu</span><span class="o">.</span><span class="n">ON</span>

<span class="c1"># Misc parameters</span>
<span class="n">clear_errors</span><span class="p">:</span> <span class="n">errorqueue</span><span class="o">.</span><span class="n">clear</span><span class="p">()</span>
<span class="n">exit_script</span><span class="p">:</span> <span class="n">exit</span><span class="p">()</span>
<span class="n">device_IDN_query</span><span class="p">:</span> <span class="s2">&quot;*IDN?&quot;</span>
<span class="n">reset_device</span><span class="p">:</span> <span class="p">[</span><span class="s2">&quot;*RST&quot;</span><span class="p">,</span> <span class="s2">&quot;*CLS&quot;</span><span class="p">]</span>
<span class="n">separator</span><span class="p">:</span> <span class="s2">&quot;,&quot;</span> <span class="c1"># The separator if queued commands are allowed</span>
</pre></div>
</div>
<p>In principal you have four different sections in a device file:</p>
<blockquote>
<div><ul class="simple">
<li><p><strong>Set Parameters</strong></p></li>
<li><p><strong>Get Parameters</strong></p></li>
<li><p><strong>Reset Parameters</strong></p></li>
<li><p><strong>Misc. Parameters</strong></p></li>
</ul>
</div></blockquote>
<p><strong>Set Parameters:</strong></p>
<p>These parameters have the prefix <code class="docutils literal notranslate"><span class="pre">set_</span></code>. This means that these parameters does not expect a response from the device.
They are simple &quot;fire-and-forget&quot;, you can not make sure, by simply sending the parameter, the device understood the command.
You may have to send an additional &quot;Get&quot; parameter to ensure successful execution.</p>
<p><strong>Get Parameters:</strong></p>
<p>These parameters have the prefix <code class="docutils literal notranslate"><span class="pre">get_</span></code>. These parameters start a query routine, so first sending the paramerter and then
waiting for an answer from the device. A simple example would be the <code class="docutils literal notranslate"><span class="pre">get_read</span></code> command, which gives you a simple reading from the device in most cases</p>
<p><strong>Reset Parameters:</strong></p>
<p>COMET has the feature to run an initialization procedure over a device, when the software boots up, or a new measurement is started.
This sets the device in a defined state and makes it easier to debug.
In order to use this feature a format has to be considered for the keys in the dictionary.
In this case you have a dict key <code class="docutils literal notranslate"><span class="pre">reset</span></code> followed by a list of commands. These commands need to have, for every key in the list, a
corresponding <code class="docutils literal notranslate"><span class="pre">set_&lt;command&gt;</span></code>. The value in the reset command will then be inserted in the set command.
To complicated? A short example is in need. Imagine you have the following device config:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="o">---</span>
<span class="n">Device_name</span><span class="p">:</span> <span class="n">SMU</span>   <span class="c1"># Device name, the name you have to state in the settings file</span>
<span class="n">Display_name</span><span class="p">:</span> <span class="n">BiasSMU</span> <span class="c1"># Some easy to read name for the user</span>
<span class="n">Device_type</span><span class="p">:</span> <span class="n">Device</span> <span class="c1"># Some descriptor what kind of device it is</span>

<span class="c1"># All set parameters</span>
<span class="n">set_beep</span><span class="p">:</span> <span class="n">beeper</span><span class="o">.</span><span class="n">beep</span><span class="p">({},</span> <span class="p">{})</span>
<span class="n">set_output</span><span class="p">:</span> <span class="n">sma</span><span class="o">.</span><span class="n">output</span><span class="p">({})</span> <span class="c1"># Sets a delay to to following command!</span>

<span class="c1"># All reset device parameters</span>
<span class="n">reset</span><span class="p">:</span>
  <span class="o">-</span> <span class="n">output</span><span class="p">:</span> <span class="n">smua</span><span class="o">.</span><span class="n">ON</span>
</pre></div>
</div>
<p>As you can see the reset paramerter is <code class="docutils literal notranslate"><span class="pre">output:</span> <span class="pre">smua.ON</span></code> therefore, the program looks for a <code class="docutils literal notranslate"><span class="pre">set_output</span></code> parameter.
If found the value <code class="docutils literal notranslate"><span class="pre">smua.ON</span></code> will be passed to the command <code class="docutils literal notranslate"><span class="pre">set_output:</span> <span class="pre">sma.output({})</span></code> which eventually result in the
command sent to the device: <code class="docutils literal notranslate"><span class="pre">sma.output(smua.ON)</span></code>. Which in this case switches on the output of the SMU.</p>
<p><strong>Misc. Parameters:</strong></p>
<p>These parameters are completely optional, you can give them names as you like, you do not have to set any prefixes or whatsoever.
I personally use these parametes for nice to know/have commands.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The only &quot;important&quot; parameter in the Misc. section is the <code class="docutils literal notranslate"><span class="pre">reset_device:</span> <span class="pre">[&quot;*RST&quot;,</span> <span class="pre">&quot;*CLS&quot;]</span></code> if you have this key in your config file, the software uses the list passed to soft-reset the device. But be aware, the software does not check any of these commands, it just sends them. Its up to you they are correct soft-reset commands!</p>
</div>
<div class="section" id="device-command-structure">
<h3>Device Command Structure<a class="headerlink" href="#device-command-structure" title="Permalink to this headline">¶</a></h3>
<p>COMETs device command structure is fairly simple. It uses the python <strong>format</strong> structure to easily be compatible with the large
varitiy of command structures for different measurement devices.</p>
<p>All command files are YAML styled files. And the first order commands are e.g. set, get, reset ... parameters. These, commands
consists of a Key: Value pair. As key, you -basically- can use whatever you want, but I would go with the recommended parameter structure described in this section.
The value to every key is then the basic command for the specific device. If this command needs a variable as input, like:
<code class="docutils literal notranslate"><span class="pre">set_voltage:</span> <span class="pre">smua.levelV</span> <span class="pre">=</span> <span class="pre">{}</span></code> just put the two curly brackets at the point where to insert value. In the software you can then
send this command via the simple command structure <code class="docutils literal notranslate"><span class="pre">vcw.query(BiasSMU,</span> <span class="pre">&quot;set_voltage&quot;,</span> <span class="pre">100.0)</span></code>. BiasSMU is in this case
the device object, containing all information about the device, &quot;set_voltage&quot; is the key and 100.0 the value. This results
in the command send to the device &quot;BiasSMU&quot;: <code class="docutils literal notranslate"><span class="pre">smua.levelV</span> <span class="pre">=</span> <span class="pre">100.0</span></code>.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>If you have several variables to be passed. Like <code class="docutils literal notranslate"><span class="pre">set_beep:</span> <span class="pre">beeper.beep({},</span> <span class="pre">{})</span></code> you can do <code class="docutils literal notranslate"><span class="pre">vcw.query(BiasSMU,</span> <span class="pre">&quot;set_beep&quot;,</span> <span class="pre">24000,</span> <span class="pre">1)</span></code>, and it will result in: <code class="docutils literal notranslate"><span class="pre">beeper.beep(24000,</span> <span class="pre">1)</span></code></p>
</div>
<p>The functionality how you can send commands is quiet extensive and would expand beyond the topic of this section. Therefore, please see
section ??? for more details.</p>
</div>
</div>
<div class="section" id="add-a-new-measurement">
<h2>Add a new measurement<a class="headerlink" href="#add-a-new-measurement" title="Permalink to this headline">¶</a></h2>
<p>In this final tutorial I will show you how to add a measurement plugin as easily as the GUI plugins from the previous section.</p>
<p>Every measurement outputs data, which eventually can be plotted. So before we do anything else we tell the GUI to recognise
the new measurement. This can be done by adding the line:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">measurement_types</span><span class="p">:</span>
   <span class="o">-</span> <span class="o">&lt;</span><span class="n">measurement_name</span><span class="o">&gt;</span> <span class="c1"># The name of a meas., if a meas. plugin gives you more than one measurement, state all here.</span>

<span class="n">measurement_order</span><span class="p">:</span>
   <span class="o">-</span> <span class="o">&lt;</span><span class="n">name_of_measurement_plugin</span><span class="o">&gt;</span> <span class="c1"># The order implies which meas. plugin is executed before another</span>
</pre></div>
</div>
<p>To the <code class="docutils literal notranslate"><span class="pre">settings.yml</span></code> of our project. This makes it possible to send data from the measurement thread to the GUI thread and the
GUI saves your data. On how to send data exactely from a measurement thread to the GUI see chapters <a class="reference internal" href="programstructure.html#the-gui-event-loop"><span class="std std-ref">The GUI event loop</span></a> and <span class="xref std std-ref">???</span>.</p>
<p>Next we need to write our measurement plugin. These plugins need to be stored as ordinary python files in the directory
<code class="docutils literal notranslate"><span class="pre">COMET\measurement_plugins</span></code>. You can name these plugins as you see fit. The important thing is that inside, there is a python
class with the exact same name as the name of the file and it contains AND the suffix <code class="docutils literal notranslate"><span class="pre">_class</span></code>. The measurement class needs to have a <strong>run</strong> function which starts the actual measurement routine.
Furthermore, the class only becomes one parameter passed during init, this being the measurement event loop instance.</p>
<p>Otherwise there are no real restrictions on how your measurement is working.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The whole measurement class will be run in a thread on their own. So make sure to be as thread save as possible when you program it. But you do not need to do anything concerning the thread capabilities of your routine. The framework takes care of that.</p>
</div>
<p>Now comes to the fun part, coding the actual measurement procedure.</p>
<p>As an example I show you a simple IV measurement plugin.</p>
<div class="highlight-python notranslate"><table class="highlighttable"><tr><td class="linenos"><div class="linenodiv"><pre> 1
 2
 3
 4
 5
 6
 7
 8
 9
10
11
12
13
14
15
16
17
18
19
20
21
22
23
24
25
26
27
28
29
30
31
32
33
34
35
36
37
38
39
40
41
42
43
44
45
46
47
48
49
50
51
52
53
54
55
56
57
58
59
60
61
62
63
64
65
66
67
68
69
70
71
72
73
74
75</pre></div></td><td class="code"><div class="highlight"><pre><span></span><span class="c1"># This file conducts a simple IV measurement</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../COMET&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="kn">import</span> <span class="n">timeit</span>
<span class="kn">from</span> <span class="nn">.forge_tools</span> <span class="kn">import</span> <span class="n">tools</span>

<span class="k">class</span> <span class="nc">IV_class</span><span class="p">(</span><span class="n">tools</span><span class="p">):</span> <span class="c1"># Every measurement muss have a class named after the file AND the suffix &#39;_class&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_class</span><span class="p">):</span>
        <span class="c1"># Here all parameters can be defind, which are crucial for the module to work, you can add as much as you want</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">main_class</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IV_class</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">framework</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="c1"># Initializes the tool box function, which gives you pre defined functions for ramping etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">framework</span><span class="p">[</span><span class="s2">&quot;VCW&quot;</span><span class="p">]</span>

        <span class="c1"># Get all devices necessary for the measurement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">IVCV_configs</span><span class="p">[</span><span class="s2">&quot;BiasSMU&quot;</span><span class="p">]]</span>

        <span class="c1"># COMET has a sophisticated logging, you can use it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Init of IV measurement plugin finished...&quot;</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">stop_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="sd">&quot;&quot;&quot;Stops the measurement, by sending a signal to the main loop, via a queue object&quot;&quot;&quot;</span>
        <span class="n">order</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ABORT_MEASUREMENT&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">queue_to_main</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="c1"># This is the mechanism to send data to the &quot;GUI&quot;</span>

    <span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># The mandatory run function</span>
        <span class="sd">&quot;&quot;&quot;Runs the IV measurement&quot;&quot;&quot;</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting IV measurement...&quot;</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">do_IV</span><span class="p">()</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;IV measurement finished...&quot;</span><span class="p">)</span>
        <span class="k">return</span> <span class="bp">None</span>

    <span class="k">def</span> <span class="nf">do_IV</span><span class="p">():</span>
         <span class="c1"># Does the whole measurement</span>
         <span class="n">voltage_step_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramp_value</span><span class="p">(</span><span class="n">voltage_Start</span><span class="p">,</span> <span class="n">voltage_End</span><span class="p">,</span> <span class="n">voltage_steps</span><span class="p">)</span> <span class="c1"># create a voltage list, with a tool box function</span>

         <span class="c1"># Config your devices, either use the config_setup from the tool box or individual commands</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">config_setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;set_output&quot;</span><span class="p">,</span> <span class="s2">&quot;OFF&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;set_voltage&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;set_compliance_current&quot;</span><span class="p">,</span> <span class="n">compliance</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_output&quot;</span><span class="p">,</span> <span class="s2">&quot;ON&quot;</span><span class="p">))</span>

         <span class="k">for</span> <span class="n">voltage</span> <span class="ow">in</span> <span class="n">voltage_step_list</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;IV measurement at voltage step: {}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">event_loop</span><span class="o">.</span><span class="n">stop_all_measurements_query</span><span class="p">():</span> <span class="c1"># To shut down if necessary, by asking if somewhere the stop signal was send</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;set_voltage&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span> <span class="c1"># Change the bias voltage and wait until stead state is reached</span>
               <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">steady_state_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IVCV_configs</span><span class="p">[</span><span class="s2">&quot;GetReadSMU&quot;</span><span class="p">],</span> <span class="n">max_slope</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">wait</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Rsq</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">compliance</span><span class="o">=</span><span class="n">compliance</span><span class="p">):</span> <span class="c1"># Is a dynamic waiting time for the measuremnts</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">stop_everything</span><span class="p">()</span> <span class="c1"># If steady state could not be reached send stop signal to framework</span>

                  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_compliance</span><span class="p">(</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">compliance</span><span class="p">)):</span> <span class="c1"># Check if compliance is reached</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">stop_everything</span><span class="p">()</span> <span class="c1"># stops the measurement if compliance is reached</span>

                  <span class="c1"># Make the measurement</span>
                  <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;get_read&quot;</span><span class="p">)</span> <span class="c1"># Gives you the command for a read, Warning: read does not need a parameter, usually this command goes build_command(device_dict, (order, value))</span>
                  <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span> <span class="c1"># Queries the command from the device</span>

                  <span class="c1"># Save the data in the measurement object and send it to the main/GUI</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">voltage</span><span class="p">)])</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],[</span><span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)])</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">queue_to_main</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s2">&quot;IV&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">voltage</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)]})</span>

                  <span class="c1"># Write the data to a file if specified</span>
                  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">save_data</span><span class="p">:</span>
                     <span class="n">string_to_write</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_files</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">],</span> <span class="n">string_to_write</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

         <span class="c1"># Ramp down and switch off SMU</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">do_ramp_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;set_voltage&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">voltage_step_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="c1"># This function automatically builds command</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_output&quot;</span><span class="p">,</span> <span class="s2">&quot;OFF&quot;</span><span class="p">))</span>
</pre></div>
</td></tr></table></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>The mechanics and functions behind the actual measurement procedure is quiet big. Therefore, I will only talk about the here programmed example but note that the framework tool box gives you a ton of functions to work with for measurement algorithm development. Please see for the dedicated tutorials on that.</p>
</div>
<p>So lets go through this program in detail:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="c1"># This file conducts a simple IV measurement</span>

<span class="kn">import</span> <span class="nn">logging</span>
<span class="kn">import</span> <span class="nn">sys</span>
<span class="kn">from</span> <span class="nn">time</span> <span class="kn">import</span> <span class="n">sleep</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="kn">as</span> <span class="nn">np</span>
<span class="n">sys</span><span class="o">.</span><span class="n">path</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="s1">&#39;../COMET&#39;</span><span class="p">)</span>
<span class="kn">from</span> <span class="nn">..utilities</span> <span class="kn">import</span> <span class="n">timeit</span>
<span class="kn">from</span> <span class="nn">.forge_tools</span> <span class="kn">import</span> <span class="n">tools</span>

<span class="k">class</span> <span class="nc">IV_class</span><span class="p">(</span><span class="n">tools</span><span class="p">):</span> <span class="c1"># Every measurement muss have a class named after the file AND the suffix &#39;_class&#39;</span>

    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">main_class</span><span class="p">):</span>
        <span class="c1"># Here all parameters can be defind, which are crucial for the module to work, you can add as much as you want</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">main</span> <span class="o">=</span> <span class="n">main_class</span>
        <span class="nb">super</span><span class="p">(</span><span class="n">IV_class</span><span class="p">,</span> <span class="bp">self</span><span class="p">)</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">framework</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="p">)</span> <span class="c1"># Initializes the tool box function, which gives you pre defined functions for ramping etc.</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span> <span class="o">=</span> <span class="n">logging</span><span class="o">.</span><span class="n">getLogger</span><span class="p">(</span><span class="vm">__name__</span><span class="p">)</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">framework</span><span class="p">[</span><span class="s2">&quot;VCW&quot;</span><span class="p">]</span>

        <span class="c1"># Get all devices necessary for the measurement</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">devices</span><span class="p">[</span><span class="bp">self</span><span class="o">.</span><span class="n">IVCV_configs</span><span class="p">[</span><span class="s2">&quot;BiasSMU&quot;</span><span class="p">]]</span>

        <span class="c1"># COMET has a sophisticated logging, you can use it</span>
        <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Init of IV measurement plugin finished...&quot;</span><span class="p">)</span>
</pre></div>
</div>
<p>Here basic modules are loaded, you are not restricted to them. You can add and remove as much as you like. The class IV_class is also
stated with the init function. Note that I inherit the <strong>tools</strong> module. It contains a multitude of functions which can help you
build your own measurement plugin. Please see the <a class="reference internal" href="Tools.html#measurement-tool-box-functions"><span class="std std-ref">Measurement Tool Box functions</span></a> for more information.
To actually use this tool box you have to init it with the <code class="docutils literal notranslate"><span class="pre">super</span></code> initiatior as shown above. This makes every function in
the tool box a member of your measurement plugin. Then I initiate the logging and the &quot;Visa Connect Wizard&quot; from the parent class,
passed as variable to the measurement plugin.</p>
<p>In the end I create a variable, containing the bias SMU so I can easily access it.</p>
<p>The next part are some member functions:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">stop_everything</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
   <span class="sd">&quot;&quot;&quot;Stops the measurement, by sending a signal to the main loop, via a queue object&quot;&quot;&quot;</span>
   <span class="n">order</span> <span class="o">=</span> <span class="p">{</span><span class="s2">&quot;ABORT_MEASUREMENT&quot;</span><span class="p">:</span> <span class="bp">True</span><span class="p">}</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">queue_to_main</span><span class="o">.</span><span class="n">put</span><span class="p">(</span><span class="n">order</span><span class="p">)</span> <span class="c1"># This is the mechanism to send data to the &quot;GUI&quot;</span>

<span class="k">def</span> <span class="nf">run</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span> <span class="c1"># The mandatory run function</span>
   <span class="sd">&quot;&quot;&quot;Runs the IV measurement&quot;&quot;&quot;</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;Starting IV measurement...&quot;</span><span class="p">)</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">do_IV</span><span class="p">()</span>
   <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">info</span><span class="p">(</span><span class="s2">&quot;IV measurement finished...&quot;</span><span class="p">)</span>
   <span class="k">return</span> <span class="bp">None</span>
</pre></div>
</div>
<p>The <code class="docutils literal notranslate"><span class="pre">stop_everything</span></code> function is a message function to the main loop of the framework. It directs the framework to stop
all measurements, this can come in handy if you reach the compliance and want to stop the measurement.</p>
<p>The other function is the <code class="docutils literal notranslate"><span class="pre">run</span></code> function. This is a crucial function, every measurement plugin needs to have. In it you
should put the mechanics to start the measurement and end it correctly. In this specific case it does not do much, except
writing to the log file and call another function:</p>
<div class="highlight-python notranslate"><div class="highlight"><pre><span></span><span class="k">def</span> <span class="nf">do_IV</span><span class="p">():</span>
         <span class="c1"># Does the whole measurement</span>
         <span class="n">voltage_step_list</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">ramp_value</span><span class="p">(</span><span class="n">voltage_Start</span><span class="p">,</span> <span class="n">voltage_End</span><span class="p">,</span> <span class="n">voltage_steps</span><span class="p">)</span> <span class="c1"># create a voltage list, with a tool box function</span>

         <span class="c1"># Config your devices, either use the config_setup from the tool box or individual commands</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">config_setup</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="p">[(</span><span class="s2">&quot;set_output&quot;</span><span class="p">,</span> <span class="s2">&quot;OFF&quot;</span><span class="p">),</span> <span class="p">(</span><span class="s2">&quot;set_voltage&quot;</span><span class="p">,</span> <span class="mi">0</span><span class="p">)])</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;set_compliance_current&quot;</span><span class="p">,</span> <span class="n">compliance</span><span class="p">)</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_output&quot;</span><span class="p">,</span> <span class="s2">&quot;ON&quot;</span><span class="p">))</span>

         <span class="k">for</span> <span class="n">voltage</span> <span class="ow">in</span> <span class="n">voltage_step_list</span><span class="p">:</span>

            <span class="bp">self</span><span class="o">.</span><span class="n">log</span><span class="o">.</span><span class="n">debug</span><span class="p">(</span><span class="s2">&quot;IV measurement at voltage step: {}...&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span>

            <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">event_loop</span><span class="o">.</span><span class="n">stop_all_measurements_query</span><span class="p">():</span> <span class="c1"># To shut down if necessary, by asking if somewhere the stop signal was send</span>
               <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;set_voltage&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">voltage</span><span class="p">))</span> <span class="c1"># Change the bias voltage and wait until stead state is reached</span>
               <span class="k">if</span> <span class="ow">not</span> <span class="bp">self</span><span class="o">.</span><span class="n">steady_state_check</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">IVCV_configs</span><span class="p">[</span><span class="s2">&quot;GetReadSMU&quot;</span><span class="p">],</span> <span class="n">max_slope</span> <span class="o">=</span> <span class="mf">1e-6</span><span class="p">,</span> <span class="n">wait</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="n">samples</span> <span class="o">=</span> <span class="mi">5</span><span class="p">,</span> <span class="n">Rsq</span> <span class="o">=</span> <span class="mf">0.5</span><span class="p">,</span> <span class="n">compliance</span><span class="o">=</span><span class="n">compliance</span><span class="p">):</span> <span class="c1"># Is a dynamic waiting time for the measuremnts</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">stop_everything</span><span class="p">()</span> <span class="c1"># If steady state could not be reached send stop signal to framework</span>

                  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">check_compliance</span><span class="p">(</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="nb">float</span><span class="p">(</span><span class="n">compliance</span><span class="p">)):</span> <span class="c1"># Check if compliance is reached</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">stop_everything</span><span class="p">()</span> <span class="c1"># stops the measurement if compliance is reached</span>

                  <span class="c1"># Make the measurement</span>
                  <span class="n">command</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">build_command</span><span class="p">(</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;get_read&quot;</span><span class="p">)</span> <span class="c1"># Gives you the command for a read, Warning: read does not need a parameter, usually this command goes build_command(device_dict, (order, value))</span>
                  <span class="n">current</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">vcw</span><span class="o">.</span><span class="n">query</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="n">command</span><span class="p">)</span> <span class="c1"># Queries the command from the device</span>

                  <span class="c1"># Save the data in the measurement object and send it to the main/GUI</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">],</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">voltage</span><span class="p">)])</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">]</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">],[</span><span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)])</span>
                  <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">queue_to_main</span><span class="o">.</span><span class="n">put</span><span class="p">({</span><span class="s2">&quot;IV&quot;</span><span class="p">:</span> <span class="p">[</span><span class="nb">float</span><span class="p">(</span><span class="n">voltage</span><span class="p">),</span> <span class="nb">float</span><span class="p">(</span><span class="n">current</span><span class="p">)]})</span>

                  <span class="c1"># Write the data to a file if specified</span>
                  <span class="k">if</span> <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">save_data</span><span class="p">:</span>
                     <span class="n">string_to_write</span> <span class="o">+=</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">0</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_data</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">][</span><span class="mi">1</span><span class="p">][</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span><span class="o">.</span><span class="n">ljust</span><span class="p">(</span><span class="mi">24</span><span class="p">)</span>
                     <span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">write</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">main</span><span class="o">.</span><span class="n">measurement_files</span><span class="p">[</span><span class="s2">&quot;IV&quot;</span><span class="p">],</span> <span class="n">string_to_write</span> <span class="o">+</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">)</span>

         <span class="c1"># Ramp down and switch off SMU</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">do_ramp_valueself</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="s2">&quot;set_voltage&quot;</span><span class="p">,</span> <span class="nb">str</span><span class="p">(</span><span class="n">voltage_step_list</span><span class="p">[</span><span class="n">i</span><span class="o">-</span><span class="mi">1</span><span class="p">]),</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">20</span><span class="p">,</span> <span class="mf">0.01</span><span class="p">)</span> <span class="c1"># This function automatically builds command</span>
         <span class="bp">self</span><span class="o">.</span><span class="n">change_value</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">bias_SMU</span><span class="p">,</span> <span class="p">(</span><span class="s2">&quot;set_output&quot;</span><span class="p">,</span> <span class="s2">&quot;OFF&quot;</span><span class="p">))</span>
</pre></div>
</div>
<p>Here the actual tasks for the IV curve is programmed. It shouldn't be hard to deceiver it and understand how it works.</p>
<p>If you start a measurement, COMET generates a numpy array for every measurement in which you can store your data.
This variable is called <code class="docutils literal notranslate"><span class="pre">self.main.measurement_data</span></code> and is a dict with keys being the different measurements possible.
It is the same type of array a the GUI one. So you can keep track of your data, without worrying to much about it.</p>
<p>One important thing is the automatic &quot;write-to-file&quot; capabilities of COMET, if you have correctly send a job to the framework
it generates you a file in which you can easily write. To do so you have to access the write method from the main. In this case you simply call:
<code class="docutils literal notranslate"><span class="pre">self.main.write(self.main.measurement_files[&quot;IV&quot;],</span> <span class="pre">string_to_write</span> <span class="pre">+</span> <span class="pre">&quot;\n&quot;)</span></code> and the string gets written to the file.
The <code class="docutils literal notranslate"><span class="pre">self.main.measurement_files</span></code> variable is a dict containing all file pointer.</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>All this easy access of the main variable is solemnly possible if you make it a member of your measurement plugin, as I did in the init!!!</p>
</div>
</div>
<div class="section" id="add-a-continuous-environment-monitor">
<h2>Add a continuous environment monitor<a class="headerlink" href="#add-a-continuous-environment-monitor" title="Permalink to this headline">¶</a></h2>
<p>COMET has the functionality to run a script for a indefinitely amount of time to monitor continuously the environment in
a setup etc. To tell COMET which script it should call you have to add the following lines to the <code class="docutils literal notranslate"><span class="pre">settings.yml</span></code> file
in you project:</p>
<div class="highlight-default notranslate"><div class="highlight"><pre><span></span><span class="n">temp_history</span><span class="p">:</span> <span class="mi">3600</span> <span class="c1"># How much should be shown in the humidity history in seconds</span>
<span class="n">temphum_update_interval</span><span class="p">:</span> <span class="mi">5000</span> <span class="c1"># Update interval of the humidity control in ms</span>
<span class="n">temphum_plugin</span><span class="p">:</span> <span class="o">&lt;</span><span class="n">plugin_name</span><span class="o">&gt;</span>
<span class="n">time_format</span><span class="p">:</span> <span class="s2">&quot;%H:%M:%S&quot;</span> <span class="c1"># Time format of the humidity control</span>
</pre></div>
</div>
<p>Most of these parameters should be self explanatory. Note: The temphum_plugin must be located with the other measurement
plugins. The same rules for naming are applying for this plugin. So the class inside must be the same name as the file.</p>
<p>This plugin gets three parameters passed by the measurement_event_loop: <em>The event loop object</em>, the <em>framework</em> variables and
the <em>update_interval</em>. This plugin class must have, like with all other measurement classes, a run directive, which starts the
routine. Furthermore, the plugin is spawned in its own thread, but the framework does not handel recalling the function. It is
in your responability the thread does not kill itself after a run through!</p>
<div class="admonition warning">
<p class="admonition-title">Warning</p>
<p>The spawned thread is a demonized thread! So it shuts down automatically when the framework shuts down.</p>
</div>
<p>For data storage of the data, the measurement_event_loop has two numpy arrays for storage: <code class="docutils literal notranslate"><span class="pre">measurement_event_loop.humidity_history</span></code>
and <code class="docutils literal notranslate"><span class="pre">measurement_event_loop.temperature_history</span></code>. You can store your data there or use your own storage solution.
If you want to pass your data to the GUI use the dedicated queue objects for data sharing like with any other measurement plugin.</p>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Do not forget to add the measurements to your settings, so your GUI recognizes your data!!! See <a class="reference internal" href="#add-a-new-measurement"><span class="std std-ref">Add a new measurement</span></a></p>
</div>
</div>
<div class="section" id="change-the-behaviour-of-the-framework-and-misc">
<h2>Change the behaviour of the framework and misc.<a class="headerlink" href="#change-the-behaviour-of-the-framework-and-misc" title="Permalink to this headline">¶</a></h2>
<p>In this chapter we discuss several features of COMET which cannot justify a own chapter but are somewhat crucial.
All these features can be accessed by a parameter in the <code class="docutils literal notranslate"><span class="pre">settings.yml</span></code> file of your project.</p>
<p><strong>GUI_update_interval: &lt;time_in_ms&gt;</strong></p>
<p>This parameter handles the update interval -in ms- of the GUI, this includes the framework functions which you specified as well.</p>
<div class="admonition caution">
<p class="admonition-title">Caution</p>
<p>Too low values can cause the GUI to freeze or be lagging. This depends on how resource depended your functions are. To high values can cause the GUI to be unresponsive.</p>
</div>
<p><strong>store_data_as: &lt;data_type&gt;</strong></p>
<p>This parameter defines an additional data type, your measurement data will be stored. Currently only <em>json</em> is supported.</p>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="measurementjobgen.html" class="btn btn-neutral float-right" title="Measurement Job Generation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="gettingstarted.html" class="btn btn-neutral float-left" title="Getting Started" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dominic Bloech

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>