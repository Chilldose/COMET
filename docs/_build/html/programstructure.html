

<!DOCTYPE html>
<!--[if IE 8]><html class="no-js lt-ie9" lang="Python 3.7" > <![endif]-->
<!--[if gt IE 8]><!--> <html class="no-js" lang="Python 3.7" > <!--<![endif]-->
<head>
  <meta charset="utf-8">
  
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  
  <title>COMET layout &mdash; COMET beta documentation</title>
  

  
  
  
  

  
  <script type="text/javascript" src="_static/js/modernizr.min.js"></script>
  
    
      <script type="text/javascript" id="documentation_options" data-url_root="./" src="_static/documentation_options.js"></script>
        <script type="text/javascript" src="_static/jquery.js"></script>
        <script type="text/javascript" src="_static/underscore.js"></script>
        <script type="text/javascript" src="_static/doctools.js"></script>
    
    <script type="text/javascript" src="_static/js/theme.js"></script>

    

  
  <link rel="stylesheet" href="_static/css/theme.css" type="text/css" />
  <link rel="stylesheet" href="_static/pygments.css" type="text/css" />
    <link rel="index" title="Index" href="genindex.html" />
    <link rel="search" title="Search" href="search.html" />
    <link rel="next" title="Installation" href="installation.html" />
    <link rel="prev" title="Welcome to the UniDAQ documentation!" href="index.html" /> 
</head>

<body class="wy-body-for-nav">

   
  <div class="wy-grid-for-nav">
    
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search" >
          

          
            <a href="index.html" class="icon icon-home"> COMET
          

          
          </a>

          
            
            
              <div class="version">
                0.10.0
              </div>
            
          

          
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>

          
        </div>

        <div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="main navigation">
          
            
            
              
            
            
              <p class="caption"><span class="caption-text">COMET Guides</span></p>
<ul class="current">
<li class="toctree-l1 current"><a class="current reference internal" href="#">COMET layout</a><ul>
<li class="toctree-l2"><a class="reference internal" href="#main-structure">Main Structure</a></li>
<li class="toctree-l2"><a class="reference internal" href="#measurement-event-loop">Measurement event loop</a></li>
<li class="toctree-l2"><a class="reference internal" href="#the-gui-event-loop">The GUI event loop</a></li>
</ul>
</li>
<li class="toctree-l1"><a class="reference internal" href="installation.html">Installation</a></li>
<li class="toctree-l1"><a class="reference internal" href="gettingstarted.html">Getting Started</a></li>
<li class="toctree-l1"><a class="reference internal" href="tutorial.html">How to</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurementjobgen.html">Measurement Job Generation</a></li>
</ul>
<p class="caption"><span class="caption-text">COMET Structure</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="datastructure.html">Data Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="dataexchange.html">Data Exchange</a></li>
</ul>
<p class="caption"><span class="caption-text">Measurement Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="measurement_plugins/IVCV.html">IVCV</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_plugins/Stripscan.html">Stripscan</a></li>
<li class="toctree-l1"><a class="reference internal" href="measurement_plugins/RelaxTimeAnalysis.html">Relaxation Time Analysis</a></li>
</ul>
<p class="caption"><span class="caption-text">General Purpose GUI Plugins</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/resources.html">Resources Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Device_Com.html">Device Communication Tab</a></li>
<li class="toctree-l1"><a class="reference internal" href="GUI_plugins/Data_Explorer.html">Data Explorer</a></li>
</ul>
<p class="caption"><span class="caption-text">Code references</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="Tools.html">Measurement Tool Box functions</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html#vcw-visa-connect-wizard">VCW - Visa Connect Wizard</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html#xyz-stage-control-class">XYZ-Stage Control Class</a></li>
<li class="toctree-l1"><a class="reference internal" href="Tools.html#switching-system-control-class">Switching System Control Class</a></li>
</ul>

            
          
        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap">

      
      <nav class="wy-nav-top" aria-label="top navigation">
        
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="index.html">COMET</a>
        
      </nav>


      <div class="wy-nav-content">
        
        <div class="rst-content">
        
          















<div role="navigation" aria-label="breadcrumbs navigation">

  <ul class="wy-breadcrumbs">
    
      <li><a href="index.html">Docs</a> &raquo;</li>
        
      <li>COMET layout</li>
    
    
      <li class="wy-breadcrumbs-aside">
        
            
            <a href="_sources/programstructure.rst.txt" rel="nofollow"> View page source</a>
          
        
      </li>
    
  </ul>

  
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
            
  <div class="section" id="comet-layout">
<h1>COMET layout<a class="headerlink" href="#comet-layout" title="Permalink to this headline">¶</a></h1>
<p>The Framework is based on a multi-thread python environment. Since python is generally not thread-safe and race conditions
are often a problem, several precautions have to be made to safely share data between the different threads. In short, COMET
has two main threads which are handling the data exchange between the GUI side and the measurement side of the program. For the GUI
to send a new measurement job and the measurement thread to send data to the GUI for plotting a thread-safe way was established to
exchange data between them. For more information on how to share data see chapter <a class="reference internal" href="dataexchange.html#data-exchange"><span class="std std-ref">Data Exchange</span></a>.</p>
<div class="section" id="main-structure">
<h2>Main Structure<a class="headerlink" href="#main-structure" title="Permalink to this headline">¶</a></h2>
<p>The picture below shows the main flow-chart of the framework. I will now give a summary of what the program does during boot-up.</p>
<p>It starts by loading all modules required for running, also check the availability of the modules. If the module cannot
be found a message will be prompted and a request will be made if you would like to install it now.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">A restart of the program may be needed, for them to work.</p>
</div>
<p>Furthermore, it prompts every action it takes while loading. After loading all modules, the init files,
like default values and device config files are loaded. Furthermore, the actual log-file will be initialized.
After all, this is done the framework tries to connect to all devices it has config files for and stores the
information on the state machine.</p>
<p>Finally, two threads are spawned, one beeing the GUI-Thread and one beeing the measurement event loop thread (see next section)</p>
<p>Concerning the GUI-Thread: Here an event loop is established which can take on messages from other parts of the program, e.g.
new data from a measurement or error messages or warnings.</p>
<p>Furthermore, it starts the 'additional framework functions' to continuously update plots and/or GUI elements. This functionality
is provided by a NON-THREAD-SAVE state machine. This is necessary to not cripple the functionality or the speed of the program.
To not have race conditions, the rule in the GUI-Thread is:</p>
<div class="admonition caution">
<p class="first admonition-title">Caution</p>
<p class="last">Never change variables that do not directly belong to the GUI. Only access non-member variables by read operations and check if the data is valid.</p>
</div>
<p>But <strong>DO NOT PANIC</strong> only a few variables are susceptible to race conditions (if you are using predefined work suits like the QTC-Software).
If you are using a blank project, like it is described in the ??? section. EVERYTHING is safe and you can use it as you please.
But be aware, you are the master of the thread save variables!!!</p>
<p>To stop the program, you have to send the right signal to the GUI-event loop. This message reads as follows: <code class="docutils literal notranslate"><span class="pre">{&quot;Status&quot;:</span> <span class="pre">{&quot;CLOSE&quot;:</span> <span class="pre">True}}</span></code></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">If the close program message is sent from ANYWHERE in the program shuts down! But if a measurement is running, the program waits until the measurement is either finished or aborted correctly, it will not kill it.</p>
</div>
<img alt="Flowchart_main" class="floatingflask" src="_images/Flowchart_QTC.png" />
</div>
<div class="section" id="measurement-event-loop">
<h2>Measurement event loop<a class="headerlink" href="#measurement-event-loop" title="Permalink to this headline">¶</a></h2>
<p>It first initializes all class instances like tools for measurements and supply functions like the queue objects for data
exchange. It furthermore initializes continuous tasks, like the humidity and temperature control/surveillance. This continuous tasks
can be extended as well.</p>
<p>After that, an event loop is established which waits for incoming messages from other threads. If one such message arrives, e.g.
a new measurement job, then the framework takes actions accordingly to the flow chart below.
If a new measurement should be conducted, a new thread will be spawned which solemnly conducts the measurement and is separated
from the rest of the framework, except for a stop-action flag. This is due to code robustness. Imagine another part of the
code consumes a lot of resources and/or crashes. Since the measurement thread is handling devices this thread may never experience
lags or something like that.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">The actual mechanism how to start a measurement see chapter <a class="reference internal" href="measurementjobgen.html#measurement-job-generation"><span class="std std-ref">Measurement Job Generation</span></a>, here a in dept explentation on how you start a measurement is explained.</p>
</div>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">If a program bug is prevalent in the actual measurement routine this mechanism will not help. So be careful while programming the measurement routines!</p>
</div>
<p>Another type of messages, which the framework can handle are status update queries, these type of messages are not specific
and can be extended. After gathering the required data, the thread sends the data back to the main thread.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This mechanism was mainly used in the early development phases and is now marked as deprecated. Status updates are now handled via thread-safe data structures, which do not need message-based data exchange.</p>
</div>
<img alt="Flowchart_meas_gen" class="floatingflask" src="_images/Flowchart_QTC_measurement_event_loop.png" />
</div>
<div class="section" id="the-gui-event-loop">
<h2>The GUI event loop<a class="headerlink" href="#the-gui-event-loop" title="Permalink to this headline">¶</a></h2>
<p>In the beginning the GUI event loop does the same things as the measurement event loop. But its purpose is different.
The GUI event handles incoming data packages for plotting, status and error message handling.</p>
<p>Starting with the error message:
If a message was sent to the event loop via the thread-safe queue in the form of <code class="docutils literal notranslate"><span class="pre">{&quot;ErrorCode&quot;:</span> <span class="pre">&quot;Some</span> <span class="pre">error</span> <span class="pre">text&quot;}</span></code> than these message will be processed and stored in a list -which is a member of the GUI- called the &quot;error.log&quot;. This can be used by the user to display all kind of messages, if the GUI is configured correctly.</p>
<p>Possible message types are:
&quot;Critical&quot;, &quot;Info&quot;,&quot;MeasError&quot;, &quot;DataError&quot;, &quot;RequestError&quot;, &quot;MEASUREMENT_FAILED&quot;, &quot;Warning&quot;, &quot;FatalError&quot;, &quot;ThresholdError&quot;, &quot;ERROR&quot;, &quot;MeasError&quot;, &quot;DataError&quot;, &quot;RequestError&quot;, &quot;MEASUREMENT_FAILED&quot;, &quot;FatalError&quot;, &quot;ThresholdError&quot;</p>
<p>all types which have the word &quot;error&quot; in it will be marked red, warnings orange and info, green all others are rendered white.</p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">This is not the actual log file the log file is a separate mechanism.</p>
</div>
<p>Furthermore, the event loop handles all messages concerning measurement procedure surveillance like:
START_MEASUREMENT, ABORT_MEASUREMENT, CLOSE_PROGRAM, MEASUREMENT_FINISHED, MEASUREMENT_EVENT_LOOP_STOPED, MEASUREMENT_STATUS.</p>
<p>These can be sent to the GUI and the GUI will take appropriate actions. The syntax is the following: <code class="docutils literal notranslate"><span class="pre">{&quot;Action&quot;:</span> <span class="pre">True}</span></code></p>
<div class="admonition warning">
<p class="first admonition-title">Warning</p>
<p class="last">I do not recommend to send any of these to the GUI by yourself from the measurement plugin ore anywhere else from the program. Except for the ABORT_MEASUREMENT and CLOSE_PROGRAM. On more information on how to correctly use it, see the dedicated chapters.</p>
</div>
<p>If you sent a message like: <code class="docutils literal notranslate"><span class="pre">{&quot;MyMeasurement&quot;:</span> <span class="pre">[[1],[2]]}</span></code>, with &quot;MyMeasurement&quot; beeing the name of a defined measurement in the config file, the event loop will append these data to the numpy array data it has stored. Furthermore, it will set a flag for the framework to update the plots, so that the data is updated in the GUI.</p>
<div class="admonition note">
<p class="first admonition-title">Note</p>
<p class="last">You are not restricted to a single value list here, you can send everything, that can be appended to a numpy array via the np.append([],[]) function.</p>
</div>
</div>
</div>


           </div>
           
          </div>
          <footer>
  
    <div class="rst-footer-buttons" role="navigation" aria-label="footer navigation">
      
        <a href="installation.html" class="btn btn-neutral float-right" title="Installation" accesskey="n" rel="next">Next <span class="fa fa-arrow-circle-right"></span></a>
      
      
        <a href="index.html" class="btn btn-neutral float-left" title="Welcome to the UniDAQ documentation!" accesskey="p" rel="prev"><span class="fa fa-arrow-circle-left"></span> Previous</a>
      
    </div>
  

  <hr/>

  <div role="contentinfo">
    <p>
        &copy; Copyright 2018, Dominic Bloech

    </p>
  </div>
  Built with <a href="http://sphinx-doc.org/">Sphinx</a> using a <a href="https://github.com/rtfd/sphinx_rtd_theme">theme</a> provided by <a href="https://readthedocs.org">Read the Docs</a>. 

</footer>

        </div>
      </div>

    </section>

  </div>
  


  <script type="text/javascript">
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script>

  
  
    
   

</body>
</html>